{"version":3,"file":"index.js","sources":["../src/helpers/is/index.js","../src/core/context/reactContext.js","../src/core/context/FakeScopeContext.js","../src/core/context/index.js","../src/core/Freeze.js","../src/core/Bridge/Context/fixContext.js","../src/core/Bridge/Context/ProviderBridge.js","../src/core/Bridge/Context/ConsumerWrapper.js","../src/core/Bridge/Context/ConsumerBridge.js","../src/core/Bridge/Suspense.js","../src/core/Bridge/ErrorBoundary.js","../src/core/Bridge/index.js","../src/core/lifecycles.js","../src/core/Keeper.js","../src/core/AliveScope.js","../src/core/withAliveScope.js","../src/helpers/saveScrollPosition.js","../src/core/KeepAlive.js"],"sourcesContent":["// 值类型判断 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\nexport const isRegExp = (val) => val instanceof RegExp\n// 值类型判断 -------------------------------------------------------------\n","import createContext from 'create-react-context'\n\n// 整个 KeepAlive 功能的上下文，将 KeepAlive 的组件藏于其 Provider 中，保证其不会被卸载\nexport const aliveScopeContext = createContext()\nexport const {\n  Provider: AliveScopeProvider,\n  Consumer: AliveScopeConsumer,\n} = aliveScopeContext\n\n// KeepAlive 组件的上下文，实现缓存生命周期功能\nexport const aliveNodeContext = createContext()\nexport const {\n  Provider: AliveNodeProvider,\n  Consumer: AliveNodeConsumer,\n} = aliveNodeContext\n","import { Component, PureComponent } from 'react'\nimport { EventBus, run, debounce } from 'szfe-tools'\n\nexport const eventBus = new EventBus()\n\nexport class FakeScopeProvider extends Component {\n  static eventBus = eventBus\n  static currentContextValue = undefined\n\n  constructor(props) {\n    super(props)\n    FakeScopeProvider.currentContextValue = props.value\n  }\n\n  shouldComponentUpdate(nextProps) {\n    if (nextProps.value !== this.props.value) {\n      FakeScopeProvider.currentContextValue = nextProps.value\n      eventBus.emit('update', nextProps.value)\n    }\n\n    return (\n      nextProps.children !== this.props.children ||\n      nextProps.value !== this.props.value\n    )\n  }\n\n  render() {\n    const { children } = this.props\n    return children\n  }\n}\n\nexport class FakeScopeConsumer extends PureComponent {\n  state = {\n    context: FakeScopeProvider.currentContextValue,\n  }\n\n  constructor(props) {\n    super(props)\n    eventBus.on('update', this.updateListener)\n  }\n\n  updateListener = debounce((nextContextValue) => {\n    this.setState({\n      context: nextContextValue,\n    })\n  })\n\n  componentWillUnmount() {\n    eventBus.off('update', this.updateListener)\n  }\n\n  render() {\n    const { children } = this.props\n    const { context } = this.state\n    return run(children, undefined, context)\n  }\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, { useState, useContext, useEffect } from 'react'\nimport { run, debounce, isFunction } from 'szfe-tools'\n\nimport {\n  aliveScopeContext,\n  AliveScopeProvider as AliveScopeReactProvider,\n  AliveScopeConsumer as AliveScopeReactConsumer,\n  aliveNodeContext,\n  AliveNodeProvider,\n  AliveNodeConsumer,\n} from './reactContext'\nimport {\n  eventBus as fakeContextEventBus,\n  FakeScopeProvider,\n  FakeScopeConsumer,\n} from './FakeScopeContext'\n\nexport const useScopeContext = () => {\n  if (!isFunction(useContext)) {\n    return {}\n  }\n\n  const scopeReactContext = useContext(aliveScopeContext)\n\n  if (scopeReactContext) {\n    return scopeReactContext\n  }\n\n  const [context, setContext] = useState(FakeScopeProvider.currentContextValue)\n\n  useEffect(() => {\n    const updateListener = debounce(setContext)\n    fakeContextEventBus.on('update', updateListener)\n    return () => fakeContextEventBus.off('update', updateListener)\n  }, [])\n\n  return context\n}\n\nexport const AliveScopeProvider = ({ children, ...props }) => (\n  <AliveScopeReactProvider {...props}>\n    <FakeScopeProvider {...props}>{children}</FakeScopeProvider>\n  </AliveScopeReactProvider>\n)\nexport const AliveScopeConsumer = ({ children }) => (\n  <AliveScopeReactConsumer>\n    {(reactContext) =>\n      !!reactContext ? (\n        run(children, undefined, reactContext)\n      ) : (\n        <FakeScopeConsumer>{children}</FakeScopeConsumer>\n      )\n    }\n  </AliveScopeReactConsumer>\n)\nexport {\n  aliveScopeContext,\n  aliveNodeContext,\n  AliveNodeProvider,\n  AliveNodeConsumer,\n}\n","// Fork from react-freeze\r\n// https://github.com/software-mansion/react-freeze/blob/main/src/index.tsx\r\nimport React, { Component, Suspense, Fragment } from 'react'\r\n\r\n// function Suspender({ freeze, children }) {\r\n//   const promiseCache = useRef({}).current\r\n//   if (freeze && !promiseCache.promise) {\r\n//     promiseCache.promise = new Promise((resolve) => {\r\n//       promiseCache.resolve = resolve\r\n//     })\r\n//     throw promiseCache.promise\r\n//   } else if (freeze) {\r\n//     throw promiseCache.promise\r\n//   } else if (promiseCache.promise) {\r\n//     promiseCache.resolve()\r\n//     promiseCache.promise = undefined\r\n//   }\r\n\r\n//   return <Fragment>{children}</Fragment>\r\n// }\r\n\r\nclass Suspender extends Component {\r\n  promiseCache = {}\r\n  render() {\r\n    const { freeze, children } = this.props\r\n    const { promiseCache } = this\r\n\r\n    if (freeze && !promiseCache.promise) {\r\n      promiseCache.promise = new Promise((resolve) => {\r\n        promiseCache.resolve = resolve\r\n      })\r\n      throw promiseCache.promise\r\n    } else if (freeze) {\r\n      throw promiseCache.promise\r\n    } else if (promiseCache.promise) {\r\n      promiseCache.resolve()\r\n      promiseCache.promise = undefined\r\n    }\r\n\r\n    return <Fragment>{children}</Fragment>\r\n  }\r\n}\r\n\r\nexport default function Freeze({ freeze, children, placeholder = null }) {\r\n  return (\r\n    <Suspense fallback={placeholder}>\r\n      <Suspender freeze={freeze}>{children}</Suspender>\r\n    </Suspense>\r\n  )\r\n}","import React from 'react'\nimport createReactContext from 'create-react-context'\nimport { get, isString, isFunction, memoize, EventBus, isExist } from 'szfe-tools'\n\nimport { aliveScopeContext, aliveNodeContext } from '../../context'\n\nexport const fixedContext = []\nexport const updateListenerCache = new Map()\nexport const eventBus = new EventBus()\n\nexport const fixContext = memoize((ctx) => {\n  if (!isExist(ctx)) {\n    return\n  }\n\n  // 排除 KeepAlive 功能的上下文\n  if ([aliveScopeContext, aliveNodeContext].includes(ctx)) {\n    return\n  }\n  fixedContext.push(ctx)\n  setTimeout(() => eventBus.emit('update'))\n})\n\nexport const createContext = (defaultValue, calculateChangedBits) => {\n  const ctx = createReactContext(defaultValue, calculateChangedBits)\n\n  fixContext(ctx)\n  return ctx\n}\n\nconst tryFixCtx = memoize((type) => {\n  // 尝试读取 Provider 或 Consumer 中的 context 静态属性\n  const ctx = get(type, '_context') || get(type, 'context') // 16.3.0 版本为 context，之后为 _context\n\n  // 判断是否为 ReactContext 类型\n  if (get(ctx, '$$typeof') === get(aliveScopeContext, '$$typeof')) {\n    fixContext(ctx)\n  }\n})\n\nconst override = (configs) => {\n  configs.forEach(([host, ...methods]) => {\n    methods.forEach((method) => {\n      if (\n        !isFunction(get(host, method)) ||\n        get(host, [method, '_overridden'])\n      ) {\n        return\n      }\n      const originMethod = host[method].bind(host)\n      host[method] = (type, ...args) => {\n        if (!isString(type)) {\n          tryFixCtx(type)\n        }\n        return originMethod(type, ...args)\n      }\n      host[method]._overridden = true\n    })\n  })\n}\n\n/**\n * 通过覆写 React.createElement 方法来探测 Provider 或 Consumer 的创建，并攫取其中 context 主动进行修复\n * TODO：同时兼容 React 17+，目前仅默认兼容 React.createElement 方法\n * React 17+ 为 require('react/jsx-runtime') 或 require('react/jsx-dev-runtime') 的 jsx、jsxs、jsxDEV 方法\n * 但由于无法动态 require，暂未想到方式同时兼容\n * 若需兼容 17+，目前手法为\n *\n * autoFixContext(\n *   [require('react/jsx-runtime'), 'jsx', 'jsxs', 'jsxDEV'],\n *   [require('react/jsx-dev-runtime'), 'jsx', 'jsxs', 'jsxDEV']\n * )\n *\n * Note: 需注意 16.2.x 及以下版本不支持此方法\n */\nexport const autoFixContext = (...configs) => {\n  try {\n    override(configs)\n  } catch (err) {\n    console.warn('activation override failed:', err)\n  }\n}\n\nautoFixContext([React, 'createElement'])\n","import React, { PureComponent } from 'react'\nimport { run, isUndefined } from 'szfe-tools'\n\nexport default class ProviderBridge extends PureComponent {\n  unmount = null\n  constructor(props) {\n    super(props)\n\n    const { value: ctxValues } = props\n\n    if (ctxValues.length === 0) {\n      this.state = {\n        ctxValue: null,\n      }\n\n      return\n    }\n\n    const [{ ctx, value, onUpdate }] = ctxValues\n\n    this.state = {\n      ctxValue: value,\n    }\n\n    this.unmount = onUpdate((value) => {\n      this.setState({\n        ctxValue: value,\n      })\n    })\n  }\n\n  componentWillUnmount() {\n    run(this.unmount)\n  }\n\n  // componentDidCatch(error) {\n  //   console.error('ProviderBridge Error', error)\n  // }\n\n  render() {\n    const { value: ctxValues, children } = this.props\n\n    if (ctxValues.length === 0) {\n      return children\n    }\n\n    const { ctxValue } = this.state\n    const [{ ctx }, ...restValues] = ctxValues\n    const { Provider } = ctx\n\n    const nextChildren = !isUndefined(ctxValue) ? (\n      <Provider value={ctxValue}>{children}</Provider>\n    ) : (\n      children\n    )\n\n    // 递归 ProviderBridge 修复多个上下文\n    // 此处未考虑待修复上下文顺序问题，按先来后到顺序处理，但理论上不应存在顺序问题\n    return restValues.length > 0 ? (\n      <ProviderBridge value={restValues}>{nextChildren}</ProviderBridge>\n    ) : (\n      nextChildren\n    )\n  }\n}\n","import { Component } from 'react'\nimport { run, get, isUndefined } from 'szfe-tools'\n\nimport { updateListenerCache } from './fixContext'\n\n// 在 KeepAlive 位置使用待修复上下文的 Consumer 探测可能存在的上下文关系\n// 若成功捕获上下文则保存其内容，用以后续 Keeper 中上下文的重建\nexport default class ConsumerWrapper extends Component {\n  updateListener = null\n  ctxInfo = null\n  constructor(props) {\n    super(props)\n\n    const { value, ctx, id } = props\n    if (isUndefined(value)) {\n      return\n    }\n\n    // 因 Consumer 探测器存在于 KeepAlive 外层故会随着 KeepAlive 卸载\n    // componentWillUnmount 中保留了已生成的更新监听器\n    // 此处重新挂载后恢复与对应 Keeper 中 ProviderBridge 的联系\n    this.updateListener = get(updateListenerCache.get(ctx), id, new Map())\n    run(this.updateListener, 'forEach', (fn) => fn(value))\n    this.ctxInfo = {\n      ctx,\n      value,\n      // 注册上下文更新的监听，保证上下文更新时 Keeper 中 ProviderBridge 内容的同步\n      onUpdate: (updator) => {\n        this.updateListener.set(updator, updator)\n\n        // 返回更新监听器的注销方法\n        return () => this.updateListener.delete(updator)\n      },\n    }\n  }\n\n  componentWillUnmount() {\n    const { value, ctx, id } = this.props\n    if (isUndefined(value)) {\n      return\n    }\n\n    // 因 Consumer 探测器存在于 KeepAlive 外层故会随着 KeepAlive 卸载\n    // 此处保留其中已生成的更新监听器，用以在重新挂载后保持与对应 Keeper 中 ProviderBridge 的联系\n    updateListenerCache.set(ctx, {\n      ...get(updateListenerCache.get(ctx), undefined, {}),\n      [id]: this.updateListener,\n    })\n  }\n\n  // 利用 shouldComponentUpdate 尽早将上下文更新的咨询通知到对应 Keeper 中 ProviderBridge\n  // TODO: 改用 componentWillReceiveProps 更早地进行更新，需注意与 getDerivedStateFromProps 新生命周期的兼容及可能存在的死循环问题\n  shouldComponentUpdate({ value }) {\n    const { value: prevValue } = this.props\n    const shouldUpdate = prevValue !== value\n\n    if (shouldUpdate) {\n      run(this.updateListener, 'forEach', (fn) => fn(value))\n    }\n\n    return true\n  }\n\n  render() {\n    const { value, renderWrapper, renderContent, id } = this.props\n\n    return renderWrapper((ctx$$) =>\n      renderContent(isUndefined(value) ? ctx$$ : [...ctx$$, this.ctxInfo])\n    )\n  }\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, {\n  PureComponent,\n  useContext,\n  useRef,\n  useEffect,\n  useState,\n} from 'react'\nimport { run, get, nextTick, isUndefined, isFunction } from 'szfe-tools'\n\nimport ConsumerWrapper from './ConsumerWrapper'\nimport { fixedContext, eventBus, updateListenerCache } from './fixContext'\n\nconst fixedContextSnapshot = {}\n\n// 对 ConsumerWrapper 的递归结构，会在 devtool 中生成较深的嵌套结构，可用 hooks 消除嵌套结构\nclass RecursiveConsumerBridge extends PureComponent {\n  constructor(props) {\n    super(props)\n    const { id } = props\n\n    if (!fixedContextSnapshot[id]) {\n      fixedContextSnapshot[id] = [...fixedContext]\n    }\n  }\n\n  renderWrapper = (renderChildren) => {\n    const { id } = this.props\n\n    const renderWrapper = fixedContextSnapshot[id].reduce(\n      (render, ctx) => {\n        const { Consumer } = ctx\n\n        const renderWrapper = (renderContent) => (\n          <Consumer>\n            {(value) => (\n              <ConsumerWrapper\n                {...{\n                  value,\n                  ctx,\n                  renderWrapper: render,\n                  renderContent,\n                  id,\n                }}\n              />\n            )}\n          </Consumer>\n        )\n\n        return renderWrapper\n      },\n      (renderContent) => renderContent([])\n    )\n\n    return renderWrapper(renderChildren)\n  }\n\n  render() {\n    const { children: renderChildren } = this.props\n\n    return this.renderWrapper(renderChildren)\n  }\n}\n\n// 若支持 Hooks，就不需要递归了，相关实现解释可参考 ConsumerWrapper\n// function HooksConsumerBridge({ children: renderChildren, id }) {\n//   const [, setRenderKey] = useState(Math.random)\n\n//   useEffect(() => {\n//     // 渲染时若 fixedContext 列表更新，则需强制刷新\n//     const updateListener = () => setRenderKey(Math.random)\n//     eventBus.on('update', updateListener)\n//     return () => {\n//       eventBus.off('update', updateListener)\n//     }\n//   }, [])\n\n//   const context$$ = fixedContext\n//     .map((ctx) => {\n//       const value = useContext(ctx)\n//       const prevValueRef = useRef(value)\n//       const { current: updateListener } = useRef(\n//         get(updateListenerCache.get(ctx), id, new Map())\n//       )\n\n//       // 尽可能早地进行更新\n//       if (prevValueRef.current !== value) {\n//         nextTick(() => run(updateListener, 'forEach', (fn) => fn(value)))\n//       }\n//       prevValueRef.current = value\n\n//       useEffect(() => {\n//         return () => {\n//           if (isUndefined(value)) {\n//             return\n//           }\n\n//           updateListenerCache.set(ctx, {\n//             ...get(updateListenerCache.get(ctx), undefined, {}),\n//             [id]: updateListener,\n//           })\n//         }\n//       }, [])\n\n//       return {\n//         ctx,\n//         value,\n//         onUpdate: (fn) => {\n//           updateListener.set(fn, fn)\n\n//           return () => updateListener.delete(fn)\n//         },\n//       }\n//     })\n//     .filter(({ value }) => !isUndefined(value))\n\n//   return renderChildren(context$$)\n// }\n\n// fix #99\n// const ConsumerBridge = [useContext, useRef, useEffect].every(isFunction)\n//   ? HooksConsumerBridge\n//   : RecursiveConsumerBridge\n// fix #99\nexport default RecursiveConsumerBridge\n","import React, { lazy, Suspense, Component, Fragment } from 'react'\nimport { run, isUndefined, isFunction } from 'szfe-tools'\n\n// 兼容性检测\nconst isSupported = isFunction(lazy) && !isUndefined(Suspense)\nconst SusNotSupported = ({ children }) => run(children)\n\nconst Lazy = isSupported ? lazy(() => new Promise(() => null)) : () => null\n\nclass FallbackListener extends Component {\n  componentDidMount() {\n    run(this.props, 'onStart')\n  }\n\n  componentWillUnmount() {\n    run(this.props, 'onEnd')\n  }\n\n  render() {\n    return null\n  }\n}\n\nfunction SuspenseBridge({ children, sus$$ }) {\n  return (\n    // 捕获 Keeper 内部可能存在的 lazy，并触发对应 KeepAlive 位置上的 LazyBridge\n    <Suspense\n      fallback={\n        <FallbackListener\n          onStart={sus$$.onSuspenseStart}\n          onEnd={sus$$.onSuspenseEnd}\n        />\n      }\n    >\n      {children}\n    </Suspense>\n  )\n}\n\nexport const LazyBridge = isSupported\n  ? class LazyBridge extends Component {\n      state = {\n        suspense: false,\n      }\n\n      onSuspenseStart = () => {\n        this.setState({\n          suspense: true,\n        })\n      }\n\n      onSuspenseEnd = () => {\n        this.setState({\n          suspense: false,\n        })\n      }\n\n      sus$$ = {\n        onSuspenseStart: this.onSuspenseStart,\n        onSuspenseEnd: this.onSuspenseEnd,\n      }\n\n      render() {\n        const { children } = this.props\n\n        return (\n          <Fragment>\n            {run(children, undefined, this.sus$$)}\n            {/* 渲染 Lazy 以触发 KeepAlive 所处位置外部可能存在的 Suspense */}\n            {this.state.suspense && <Lazy />}\n          </Fragment>\n        )\n      }\n    }\n  : SusNotSupported\n\nexport default isSupported ? SuspenseBridge : SusNotSupported\n","import { Component } from 'react'\nimport { run } from 'szfe-tools'\n\nexport default class ErrorBoundaryBridge extends Component {\n  // Error Boundary 透传至对应 KeepAlive 实例位置\n  static getDerivedStateFromError = () => null\n  componentDidCatch(error) {\n    const { error$$: throwError } = this.props\n\n    run(throwError, undefined, error, () => {\n      run(throwError, undefined, null)\n    })\n  }\n\n  render() {\n    return this.props.children\n  }\n}\n\nexport class ErrorThrower extends Component {\n  state = {\n    error: null,\n  }\n\n  throwError = (error, cb) => this.setState({ error }, cb)\n  render() {\n    if (this.state.error) {\n      throw this.state.error\n    }\n\n    return run(this.props.children, undefined, this.throwError)\n  }\n}\n","import React from 'react'\nimport { run } from 'szfe-tools'\n\nimport { ProviderBridge, ConsumerBridge } from './Context'\nimport SuspenseBridge, { LazyBridge } from './Suspense'\nimport ErrorBoundaryBridge, { ErrorThrower } from './ErrorBoundary'\n\n// 用于 Keeper 中，实现 Keeper 向外或向内的桥接代理\nexport default function Bridge({ id, children, bridgeProps }) {\n  const { sus$$, ctx$$, error$$ } = bridgeProps\n\n  return (\n    /* 由内向外透传 componentDidCatch 捕获的 error */\n    <ErrorBoundaryBridge error$$={error$$}>\n      {/* 由内向外透传 lazy 行为 */}\n      <SuspenseBridge sus$$={sus$$}>\n        {/* 由外向内透传可能存在的 Consumer 数据 */}\n        <ProviderBridge id={id} value={ctx$$}>\n          {children}\n        </ProviderBridge>\n      </SuspenseBridge>\n    </ErrorBoundaryBridge>\n  )\n}\n\n// 用于 KeepAlive 中，实现 KeepAlive 向外或向内的桥接代理\nexport function Acceptor({ id, children }) {\n  return (\n    /* 由内向外透传 componentDidCatch 捕获的 error */\n    <ErrorThrower>\n      {(error$$) => (\n        /* 由内向外透传 lazy 行为 */\n        <LazyBridge>\n          {(sus$$) => (\n            /* 由外向内透传可能被捕获的 Provider 数据 */\n            <ConsumerBridge id={id}>\n              {(ctx$$) =>\n                run(children, undefined, {\n                  bridgeProps: {\n                    sus$$,\n                    ctx$$,\n                    error$$,\n                  },\n                })\n              }\n            </ConsumerBridge>\n          )}\n        </LazyBridge>\n      )}\n    </ErrorThrower>\n  )\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, {\n  Component,\n  forwardRef,\n  useEffect,\n  useRef,\n  useContext,\n} from 'react'\nimport hoistStatics from 'hoist-non-react-statics'\nimport {\n  get,\n  run,\n  nextTick,\n  isObject,\n  isFunction,\n  isUndefined,\n} from 'szfe-tools'\n\nimport { AliveNodeConsumer, aliveNodeContext } from './context'\n\nexport const LIFECYCLE_ACTIVATE = 'componentDidActivate'\nexport const LIFECYCLE_UNACTIVATE = 'componentWillUnactivate'\n\nexport const withActivation = (WrappedComponent) => {\n  class HOC extends Component {\n    drop = null\n\n    componentWillUnmount() {\n      run(this.drop)\n    }\n\n    render() {\n      const { forwardedRef, ...props } = this.props\n\n      return (\n        <AliveNodeConsumer>\n          {({ attach } = {}) => (\n            <WrappedComponent\n              ref={(ref) => {\n                if (\n                  [LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE].every(\n                    (lifecycleName) => !isFunction(get(ref, lifecycleName))\n                  )\n                ) {\n                  return\n                }\n                this.drop = run(attach, undefined, ref)\n\n                // 以下保持 ref 功能\n                if (isUndefined(forwardedRef)) {\n                  return\n                }\n\n                if (isObject(forwardedRef) && 'current' in forwardedRef) {\n                  forwardedRef.current = ref\n                  return\n                }\n\n                run(forwardedRef, undefined, ref)\n              }}\n              {...props}\n            />\n          )}\n        </AliveNodeConsumer>\n      )\n    }\n  }\n\n  // 由于 KeepAlive 内组件渲染与实际内容落后一个节拍\n  // 将导致真实节点的 componentDidMount 无法及时获取到 KeepAlive 中内容的 ref 值\n  // 此处对使用了 withActivation HOC 的组件 componentDidMount 做 nextTick 延时处理\n  // 修复上述问题\n\n  if (isFunction(WrappedComponent.prototype.componentDidMount)) {\n    WrappedComponent.prototype._componentDidMount =\n      WrappedComponent.prototype.componentDidMount\n    WrappedComponent.prototype.componentDidMount = function componentDidMount() {\n      nextTick(() => WrappedComponent.prototype._componentDidMount.call(this))\n    }\n  }\n\n  if (isFunction(forwardRef)) {\n    const ForwardedRefHOC = forwardRef((props, ref) => (\n      <HOC {...props} forwardedRef={ref} />\n    ))\n\n    return hoistStatics(ForwardedRefHOC, WrappedComponent)\n  } else {\n    return hoistStatics(HOC, WrappedComponent)\n  }\n}\n\nconst useActivation = (funcName, func) => {\n  // 兼容性判断\n  if ([useRef, useContext, useEffect].some((fn) => !isFunction(fn))) {\n    return\n  }\n\n  const ctxValue = useContext(aliveNodeContext)\n\n  // 未处于 KeepAlive 中\n  if (!ctxValue) {\n    return\n  }\n\n  const { current: ref } = useRef({})\n  const { attach } = ctxValue\n\n  ref[funcName] = func\n  ref.drop = attach(ref)\n\n  useEffect(() => {\n    return () => run(ref.drop)\n  }, [])\n}\n\nexport const useActivate = useActivation.bind(null, LIFECYCLE_ACTIVATE)\nexport const useUnactivate = useActivation.bind(null, LIFECYCLE_UNACTIVATE)\n","import React, { PureComponent, Suspense } from 'react'\nimport { get, run, nextTick, EventBus } from 'szfe-tools'\n\nimport ReactFreeze from './Freeze'\nimport Bridge from './Bridge'\nimport { AliveNodeProvider } from './context'\nimport { LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE } from './lifecycles'\n\nconst Freeze = !!Suspense ? ReactFreeze : ({ children }) => children\n\nexport default class Keeper extends PureComponent {\n  eventBus = new EventBus()\n  listeners = new Map()\n  wrapper = null\n\n  constructor(props, ...rest) {\n    super(props, ...rest)\n\n    this.state = {\n      children: props.children,\n      bridgeProps: props.bridgeProps,\n      key: Math.random(),\n      freeze: false,\n    }\n  }\n\n  cache = undefined\n  componentDidMount() {\n    const { store, id } = this.props\n    const listeners = this.listeners\n    const node = this.wrapper\n\n    // 已存在检测，防止意外现象\n    if (store.has(id)) {\n      return\n    }\n\n    let nodes\n    try {\n      nodes = [...node.children]\n    } catch (e) {\n      nodes = [node.children]\n    }\n\n    this.cache = {\n      listeners,\n      aliveNodesId: [],\n      inited: false,\n      cached: false,\n      wrapper: node,\n      nodes,\n      [LIFECYCLE_ACTIVATE]: () => this[LIFECYCLE_ACTIVATE](),\n      [LIFECYCLE_UNACTIVATE]: () => this[LIFECYCLE_UNACTIVATE](),\n    }\n\n    store.set(id, this.cache)\n  }\n\n  \n  unmounted = false\n  safeSetState = (nextState, callback) => {\n    // fix #170\n    if (this.unmounted) {\n      return\n    }\n    this.setState(nextState, callback)\n  }\n  componentWillUnmount() {\n    const { store, keepers, id } = this.props\n    // 卸载前尝试归位 DOM 节点\n    try {\n      const cache = store.get(id)\n      cache.nodes.forEach((node) => {\n        cache.wrapper.appendChild(node)\n      })\n    } catch (error) {\n      // console.error(error) // do nothing\n    }\n    store.delete(id)\n    keepers.delete(id)\n    this.unmounted = true\n  }\n\n  freezeTimeout = null\n\n  ;[LIFECYCLE_ACTIVATE]() {\n    clearTimeout(this.freezeTimeout)\n    // 激活后，立即解冻\n    this.safeSetState({\n      freeze: false,\n    })\n    this.eventBus.emit(LIFECYCLE_ACTIVATE)\n    this.listeners.forEach((listener) => run(listener, [LIFECYCLE_ACTIVATE]))\n  }\n\n  ;[LIFECYCLE_UNACTIVATE]() {\n    this.eventBus.emit(LIFECYCLE_UNACTIVATE)\n    const listeners = [...this.listeners]\n\n    listeners\n      .reverse()\n      .forEach(([, listener]) => run(listener, [LIFECYCLE_UNACTIVATE]))\n\n    // 缓存后，延迟冻结，保证各项后续处理得以进行，如关闭弹窗等\n    clearTimeout(this.freezeTimeout)\n    this.freezeTimeout = setTimeout(() => {\n      this.safeSetState({\n        freeze: true,\n      })\n    }, 1000)\n  }\n\n  // // 原先打算更新过程中先重置 dom 节点状态，更新后恢复 dom 节点\n  // // 但考虑到性能消耗可能过大，且可能因 dom 操作时机引发其他 react 渲染问题，故不使用\n  // // 对应 KeepAlive 处 update 也注释起来不使用\n  // // 组件更新后，更新 DOM 节点列表状态\n  // componentDidUpdate() {\n  //   const { store, id } = this.props\n  //   const node = this.wrapper\n  //   if (get(node, 'children.length') > 0) {\n  //     store[id].nodes = [...node.children]\n  //   }\n\n  //   console.log(store[id].nodes)\n  // }\n\n  // 生命周期绑定\n  attach = (ref) => {\n    const listeners = this.listeners\n\n    if (!ref) {\n      return () => null\n    }\n\n    if (ref.isKeepAlive) {\n      nextTick(() => {\n        const { id, store } = this.props\n        const cache = store.get(id)\n        cache.aliveNodesId = new Set([...cache.aliveNodesId, ref.id])\n      })\n    }\n\n    listeners.set(ref, {\n      [LIFECYCLE_ACTIVATE]: () => run(ref, LIFECYCLE_ACTIVATE),\n      [LIFECYCLE_UNACTIVATE]: () => run(ref, LIFECYCLE_UNACTIVATE),\n    })\n\n    // 返回 listenerRemover 用以在对应组件卸载时解除监听\n    return () => {\n      listeners.delete(ref)\n    }\n  }\n\n  // 静态化节点上下文内容，防止重复渲染\n  contextValue = {\n    id: this.props.id,\n    attach: this.attach,\n  }\n\n  drop = ({ delay = 1200 } = {}) =>\n    new Promise((resolve) => {\n      let timeout\n      const { scope, id } = this.props\n      const drop = () => {\n        clearTimeout(timeout)\n        this.eventBus.off(LIFECYCLE_UNACTIVATE, drop)\n        // 用在多层 KeepAlive 同时触发 drop 时，避免触发深层 KeepAlive 节点的缓存生命周期\n        this.cache.willDrop = true\n        scope.nodes.delete(id)\n        scope.helpers = { ...scope.helpers }\n        scope.smartForceUpdate(() => resolve(true))\n      }\n\n      const canDrop = get(this.cache, 'cached') || get(this.cache, 'willDrop')\n      if (!canDrop) {\n        this.eventBus.on(LIFECYCLE_UNACTIVATE, drop)\n        timeout = setTimeout(() => {\n          this.eventBus.off(LIFECYCLE_UNACTIVATE, drop)\n          resolve(false)\n        }, delay)\n        return\n      }\n\n      drop()\n    })\n\n  refresh = () =>\n    new Promise((resolve) => {\n      const canRefresh = !get(this.cache, 'cached')\n      if (!canRefresh) {\n        resolve(false)\n      }\n      this.safeSetState(\n        {\n          key: Math.random(),\n        },\n        () => resolve(true)\n      )\n    })\n\n  render() {\n    const { id, ...props } = this.props\n    const { children, bridgeProps, key, freeze } = this.state\n\n    return (\n      <Freeze freeze={freeze}>\n        <div\n          ref={(node) => {\n            this.wrapper = node\n          }}\n        >\n          <div key=\"keeper-container\" nodeKeyIgnore className=\"ka-content\">\n            <Bridge id={id} bridgeProps={bridgeProps}>\n              <AliveNodeProvider value={this.contextValue}>\n                {React.Children.map(children, (child, idx) =>\n                  React.cloneElement(child, {\n                    key: `${child.key || ''}:${key}:${idx}`,\n                  })\n                )}\n              </AliveNodeProvider>\n            </Bridge>\n          </div>\n        </div>\n      </Freeze>\n    )\n  }\n}\n","import React, { Component } from 'react'\nimport { get, run, flatten, debounce, globalThis as root } from 'szfe-tools'\n\nimport { isRegExp } from '../helpers/is'\nimport { AliveScopeProvider } from './context'\nimport Keeper from './Keeper'\n\nconst HANDLE_TYPE_DROP = 'drop'\nconst HANDLE_TYPE_REFRESH = 'refresh'\n\nexport default class AliveScope extends Component {\n  store = new Map()\n  nodes = new Map()\n  keepers = new Map()\n\n  debouncedForceUpdate = debounce((cb) => this.forceUpdate(cb))\n  updateCallbackList = []\n  smartForceUpdate = (cb) => {\n    this.updateCallbackList.push(cb)\n    this.debouncedForceUpdate(() => {\n      this.updateCallbackList.forEach((cb) => run(cb))\n      this.updateCallbackList = []\n    })\n  }\n  update = (id, params) =>\n    new Promise((resolve) => {\n      const keeper = this.keepers.get(id)\n      const isNew = !keeper\n      const now = Date.now()\n      const node = this.nodes.get(id) || null\n      this.nodes.set(id, {\n        id,\n        createTime: now,\n        updateTime: now,\n        ...node,\n        ...params,\n      })\n\n      if (isNew) {\n        this.helpers = { ...this.helpers }\n\n        this.forceUpdate(resolve)\n      } else {\n        const { children, bridgeProps } = params\n        keeper.setState({ children, bridgeProps }, resolve)\n      }\n    })\n\n  keep = (id, params) =>\n    new Promise((resolve) => {\n      this.update(id, {\n        id,\n        ...params,\n      }).then(() => {\n        resolve(this.store.get(id))\n      })\n    })\n\n  getCachingNodesByName = (name) =>\n    this.getCachingNodes().filter((node) =>\n      isRegExp(name) ? name.test(node.name) : node.name === name\n    )\n\n  getScopeIds = (ids) => {\n    // 递归采集 scope alive nodes id\n    const getCachingNodesId = (id) => {\n      const aliveNodesId = get(this.getCache(id), 'aliveNodesId', [])\n\n      if (aliveNodesId.size > 0) {\n        return [id, [...aliveNodesId].map(getCachingNodesId)]\n      }\n\n      return [id, ...aliveNodesId]\n    }\n\n    return flatten(ids.map((id) => getCachingNodesId(id)))\n  }\n\n  dropById = (id, ...rest) => this.handleNodes([id], HANDLE_TYPE_DROP, ...rest)\n  dropScopeByIds = (ids, ...rest) =>\n    this.handleNodes(this.getScopeIds(ids), HANDLE_TYPE_DROP, ...rest)\n\n  drop = (name, ...rest) =>\n    this.handleNodes(\n      this.getCachingNodesByName(name).map((node) => node.id),\n      HANDLE_TYPE_DROP,\n      ...rest\n    )\n\n  dropScope = (name, ...rest) =>\n    this.dropScopeByIds(\n      this.getCachingNodesByName(name).map(({ id }) => id),\n      ...rest\n    )\n\n  refreshById = (id, ...rest) =>\n    this.handleNodes([id], HANDLE_TYPE_REFRESH, ...rest)\n  refreshScopeByIds = (ids, ...rest) =>\n    this.handleNodes(this.getScopeIds(ids), HANDLE_TYPE_REFRESH, ...rest)\n\n  refresh = (name, ...rest) =>\n    this.handleNodes(\n      this.getCachingNodesByName(name).map((node) => node.id),\n      HANDLE_TYPE_REFRESH,\n      ...rest\n    )\n\n  refreshScope = (name, ...rest) =>\n    this.refreshScopeByIds(\n      this.getCachingNodesByName(name).map(({ id }) => id),\n      ...rest\n    )\n\n  handleNodes = (nodesId, type = HANDLE_TYPE_DROP, ...rest) =>\n    new Promise((resolve) => {\n      const handleKeepers = []\n\n      nodesId.forEach((id) => {\n        const cache = this.store.get(id)\n\n        if (!cache) {\n          return\n        }\n\n        const keeper = this.keepers.get(id)\n        handleKeepers.push(keeper)\n      })\n\n      if (handleKeepers.length === 0) {\n        resolve(false)\n        return\n      }\n\n      Promise.all(\n        handleKeepers.map((keeper) => run(keeper, type, ...rest))\n      ).then((responses) => resolve(responses.every(Boolean)))\n    })\n\n  clear = (...rest) =>\n    this.handleNodes(\n      this.getCachingNodes().map(({ id }) => id),\n      HANDLE_TYPE_DROP,\n      ...rest\n    )\n\n  getCache = (id) => this.store.get(id)\n  getNode = (id) => this.nodes.get(id)\n  getCachingNodes = () => [...this.nodes.values()]\n\n  // 静态化节点上下文内容，防止重复渲染\n  helpers = {\n    keep: this.keep,\n    update: this.update,\n    drop: this.drop,\n    dropScope: this.dropScope,\n    dropById: this.dropById,\n    dropScopeByIds: this.dropScopeByIds,\n    refresh: this.refresh,\n    refreshScope: this.refreshScope,\n    refreshById: this.refreshById,\n    refreshScopeByIds: this.refreshScopeByIds,\n    getScopeIds: this.getScopeIds,\n    clear: this.clear,\n    getCache: this.getCache,\n    getNode: this.getNode,\n    getCachingNodes: this.getCachingNodes,\n  }\n\n  render() {\n    const { children = null } = this.props\n\n    return (\n      <AliveScopeProvider value={this.helpers}>\n        {children}\n        <div style={{ display: 'none' }}>\n          {[...this.nodes.values()].map(({ children, ...props }) => (\n            <Keeper\n              key={props.id}\n              {...props}\n              scope={this}\n              store={this.store}\n              keepers={this.keepers}\n              ref={(keeper) => {\n                this.keepers.set(props.id, keeper)\n              }}\n            >\n              {children}\n            </Keeper>\n          ))}\n        </div>\n      </AliveScopeProvider>\n    )\n  }\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, { forwardRef, useContext } from 'react'\nimport hoistStatics from 'hoist-non-react-statics'\nimport { get, isFunction, isUndefined } from 'szfe-tools'\n\nimport { Acceptor } from './Bridge'\nimport NodeKey from './NodeKey'\nimport { AliveScopeConsumer, useScopeContext } from './context'\n\nfunction controllerCherryPick(controller) {\n  const {\n    drop,\n    dropScope,\n    refresh,\n    refreshScope,\n    clear,\n    getCachingNodes,\n  } = controller\n  return { drop, dropScope, refresh, refreshScope, clear, getCachingNodes }\n}\n\nexport const expandKeepAlive = (KeepAlive) => {\n  const renderContent = ({ idPrefix, helpers, props }) => {\n    const isOutsideAliveScope = isUndefined(helpers)\n\n    if (isOutsideAliveScope) {\n      console.error('You should not use <KeepAlive /> outside a <AliveScope>')\n    }\n\n    return isOutsideAliveScope ? (\n      get(props, 'children', null)\n    ) : (\n      <NodeKey prefix={idPrefix} key={props._nk} manualKey={props.cacheKey}>\n        {(nkId) => {\n          const id = props.cacheKey || nkId\n\n          return (\n            <Acceptor key={id} id={id}>\n              {(bridgeProps) => (\n                <KeepAlive\n                  key={id}\n                  {...props}\n                  {...bridgeProps}\n                  id={id}\n                  _helpers={helpers}\n                />\n              )}\n            </Acceptor>\n          )\n        }}\n      </NodeKey>\n    )\n  }\n  const HookExpand = ({ id: idPrefix, ...props }) =>\n    renderContent({ idPrefix, helpers: useScopeContext(), props })\n\n  const WithExpand = ({ id: idPrefix, ...props }) => (\n    <AliveScopeConsumer>\n      {(helpers) => renderContent({ idPrefix, helpers, props })}\n    </AliveScopeConsumer>\n  )\n\n  return isFunction(useContext) ? HookExpand : WithExpand\n}\n\nconst withAliveScope = (WrappedComponent) => {\n  const renderContent = ({ helpers, props, forwardedRef }) => (\n    <WrappedComponent {...props} {...helpers} ref={forwardedRef} />\n  )\n\n  const HookScope = ({ forwardedRef, ...props }) =>\n    renderContent({\n      helpers: controllerCherryPick(useScopeContext() || {}),\n      props,\n      forwardedRef,\n    })\n\n  const WithScope = ({ forwardedRef, ...props }) => (\n    <AliveScopeConsumer>\n      {(controller = {}) =>\n        renderContent({\n          helpers: controllerCherryPick(controller),\n          props,\n          forwardedRef,\n        })\n      }\n    </AliveScopeConsumer>\n  )\n\n  const HOCWithAliveScope = isFunction(useContext) ? HookScope : WithScope\n\n  if (isFunction(forwardRef)) {\n    const ForwardedRefHOC = forwardRef((props, ref) => (\n      <HOCWithAliveScope {...props} forwardedRef={ref} />\n    ))\n\n    return hoistStatics(ForwardedRefHOC, WrappedComponent)\n  } else {\n    return hoistStatics(HOCWithAliveScope, WrappedComponent)\n  }\n}\n\nexport const useAliveController = () => {\n  if (!isFunction(useContext)) {\n    return {}\n  }\n\n  const ctxValue = useScopeContext()\n\n  if (!ctxValue) {\n    return {}\n  }\n\n  return controllerCherryPick(ctxValue)\n}\n\nexport default withAliveScope\n","import {\n  globalThis as root,\n  get,\n  run,\n  value,\n  isFunction,\n  isExist,\n  flatten,\n} from 'szfe-tools'\n\nfunction isScrollableNode(node = {}) {\n  if (!isExist(node)) {\n    return false\n  }\n\n  return (\n    node.scrollWidth > node.clientWidth || node.scrollHeight > node.clientHeight\n  )\n}\n\nfunction getScrollableNodes(from) {\n  if (!isFunction(get(root, 'document.querySelectorAll'))) {\n    return []\n  }\n\n  return [...value(run(from, 'querySelectorAll', '*'), []), from].filter(\n    isScrollableNode\n  )\n}\n\nexport default function saveScrollPosition(from) {\n  const nodes = [...new Set([...flatten(from.map(getScrollableNodes))])]\n\n  const saver = nodes.map((node) => [\n    node,\n    {\n      x: node.scrollLeft,\n      y: node.scrollTop,\n    },\n  ])\n\n  return function revert() {\n    saver.forEach(([node, { x, y }]) => {\n      node.scrollLeft = x\n      node.scrollTop = y\n    })\n  }\n}\n","import React, { Component } from 'react'\nimport {\n  value,\n  get,\n  run,\n  globalThis as root,\n  nextTick,\n  isFunction,\n  isArray,\n  debounce,\n  flatten,\n} from 'szfe-tools'\n\nimport { expandKeepAlive } from './withAliveScope'\nimport {\n  LIFECYCLE_ACTIVATE,\n  LIFECYCLE_UNACTIVATE,\n  withActivation,\n} from './lifecycles'\nimport saveScrollPosition from '../helpers/saveScrollPosition'\n\nconst body = get(root, 'document.body')\nconst screenScrollingElement = get(\n  root,\n  'document.scrollingElement',\n  get(root, 'document.documentElement', {})\n)\n\nconst getErrorTips = (name) =>\n  `<KeepAlive ${\n    name ? `name=\"${name}\" ` : ''\n  }/> Too many transient updates, may have encountered an infinite loop of updates, forced to pause the update\nThere are serious performance issues with the update results you are currently seeing\nMay encounter an implied bug, please don't use KeepAlive and contact the author to solve`\n\nconst parseWhenResult = (res) => {\n  if (isArray(res)) {\n    return res\n  }\n\n  return [res]\n}\n\nclass KeepAlive extends Component {\n  static defaultProps = {\n    saveScrollPosition: true,\n  }\n  // 本段为 KeepAlive 更新隐患检测，通过检测 KeepAlive 瞬时更新次数来判断是否进入死循环，并在 update 中强制阻止更新\n  updateTimes = 0\n  errorTips = debounce(() => {\n    const { name } = this.props\n    console.error(getErrorTips(name))\n  }, 100)\n  releaseUpdateTimes = debounce(() => {\n    this.updateTimes = 0\n  }, 16)\n  needForceStopUpdate = () => {\n    const needForceStopUpdate = this.updateTimes > 64\n\n    if (needForceStopUpdate) {\n      this.errorTips()\n    }\n\n    this.updateTimes++\n    this.releaseUpdateTimes()\n\n    return needForceStopUpdate\n  }\n\n  id = null // 用作 Keeper 识别 KeepAlive\n  isKeepAlive = true // 用作 Keeper 识别 KeepAlive\n  cached = false\n  constructor(props) {\n    super(props)\n    this.id = props.id\n    this.init()\n\n    // 继承响应父级 KeepAlive 的生命周期\n    ;[LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE].forEach((lifecycleName) => {\n      this[lifecycleName] = () => {\n        const { id, _helpers } = this.props\n        const cache = _helpers.getCache(id)\n        const node = _helpers.getNode(id)\n        if (node && lifecycleName === LIFECYCLE_ACTIVATE) {\n          node.updateTime = Date.now()\n        }\n\n        const cached = lifecycleName === LIFECYCLE_UNACTIVATE\n\n        // 若组件即将卸载则不再触发缓存生命周期\n        if (!cache || cache.willDrop) {\n          // 若组件在父 KeepAlive 缓存期间被卸载，后续恢复后需重新触发 init\n          if (this.cached && !cached) {\n            this.init()\n          }\n          return\n        }\n\n        run(cache, lifecycleName)\n        cache.cached = cached\n        this.cached = cached\n      }\n    })\n  }\n\n  // DOM 操作将实际内容插入占位元素\n  inject = (didActivate = true) => {\n    const { id, saveScrollPosition, _helpers } = this.props\n    const cache = _helpers.getCache(id)\n    // DOM 操作有风险，try catch 护体\n    try {\n      // // 原计划不增加额外的节点，直接将 Keeper 中所有内容节点一一迁移\n      // // 后发现缺乏统一 react 认可的外层包裹，可能会造成 react dom 操作的错误\n      // // 且将导致 KeepAlive 进行 update 时需先恢复各 dom 节点的组件归属，成本过高\n      // // 故此处增加统一的 div 外层，Keeper 中与 KeepAlive 中各一个且外层不做移除处理\n      // this.parentNode = this.placeholder.parentNode\n      // cache.nodes.forEach(node => {\n      //   this.parentNode.insertBefore(node, this.placeholder)\n      // })\n      // this.parentNode.removeChild(this.placeholder)\n      // 将 AliveScopeProvider 中的渲染内容通过 dom 操作置回当前 KeepAlive\n      cache.nodes.forEach((node) => {\n        this.placeholder.appendChild(node)\n      })\n\n      if (didActivate && saveScrollPosition) {\n        // 恢复该节点下各可滚动元素的滚动位置\n        run(cache.revertScrollPos)\n      }\n    } catch (error) {\n      // console.error(error)\n    }\n  }\n\n  // DOM 操作将实际内容移出占位元素\n  eject = (willUnactivate = true) => {\n    const { id, _helpers } = this.props\n    const cache = _helpers.getCache(id)\n    const nodesNeedToSaveScrollPosition = flatten(\n      flatten([this.props.saveScrollPosition]).map((flag) => {\n        if (flag === true) {\n          return cache.nodes\n        }\n\n        if (flag === 'screen') {\n          return [screenScrollingElement, body]\n        }\n\n        return [...value(run(root, 'document.querySelectorAll', flag), [])]\n      })\n    ).filter(Boolean)\n\n    // DOM 操作有风险，try catch 护体\n    try {\n      if (willUnactivate && nodesNeedToSaveScrollPosition.length > 0) {\n        // 保存该节点下各可滚动元素的滚动位置\n        cache.revertScrollPos = saveScrollPosition(\n          nodesNeedToSaveScrollPosition\n        )\n      }\n\n      // // 原计划不增加额外的节点，直接将 Keeper 中所有内容节点一一迁移\n      // // 后发现缺乏统一 react 认可的外层包裹，可能会造成 react dom 操作的错误\n      // // 且将导致 KeepAlive 进行 update 时需先恢复各 dom 节点的组件归属，成本过高\n      // // 故此处增加统一的 div 外层，Keeper 中与 KeepAlive 中各一个且外层不做移除处理\n      // this.parentNode.insertBefore(this.placeholder, cache.nodes[0])\n      // cache.nodes.forEach(node => {\n      //   if (willUnactivate) {\n      //     this.parentNode.removeChild(node)\n      //   } else {\n      //     cache.wrapper.appendChild(node)\n      //   }\n      // })\n      // this.parentNode.insertBefore(this.placeholder, cache.nodes[0])\n      // 将 KeepAlive 中的节点恢复为原先的占位节点，保证卸载操作正常进行\n      cache.nodes.forEach((node) => {\n        if (willUnactivate) {\n          this.placeholder.removeChild(node)\n        } else {\n          cache.wrapper.appendChild(node)\n        }\n      })\n    } catch (error) {\n      // console.error(error)\n    }\n  }\n\n  init = () => {\n    const { _helpers, id, children, ...rest } = this.props\n\n    // 将 children 渲染至 AliveScopeProvider 中\n    _helpers\n      .keep(id, {\n        children,\n        getInstance: () => this,\n        ...rest,\n      })\n      .then((cache) => {\n        // fix #22\n        if (!cache) {\n          return\n        }\n\n        this.inject()\n\n        // 触发 didActivate 生命周期\n        if (cache.inited) {\n          run(this, LIFECYCLE_ACTIVATE)\n        } else {\n          cache.inited = true\n        }\n        this.cached = false\n      })\n  }\n\n  update = ({ _helpers, id, name, ...rest } = {}) => {\n    if (!_helpers || this.cached || this.needForceStopUpdate(name)) {\n      return\n    }\n\n    // // 原先打算更新过程中先重置 dom 节点状态，更新后恢复 dom 节点\n    // // 但考虑到性能消耗可能过大，且可能因 dom 操作时机引发其他 react 渲染问题，故不使用\n    // // 对应 Keeper 处 componentDidUpdate 也注释起来不使用\n    // this.eject(false)\n    _helpers.update(id, {\n      name,\n      getInstance: () => this,\n      ...rest,\n    })\n    // this.inject(false)\n  }\n\n  // 利用 shouldComponentUpdate 提前触发组件更新\n  shouldComponentUpdate(nextProps) {\n    this.update(nextProps)\n\n    return false\n  }\n\n  // 组件卸载时重置 dom 状态，保证 react dom 操作正常进行，并触发 unactivate 生命周期\n  componentWillUnmount() {\n    const { id, _helpers, when: calcWhen = true } = this.props\n    const cache = _helpers.getCache(id)\n    const [when, isScope] = parseWhenResult(run(calcWhen))\n\n    if (!cache) {\n      return\n    }\n\n    this.eject()\n    delete cache.getInstance\n\n    if (!when) {\n      if (isScope) {\n        const needToDrop = [\n          cache,\n          ..._helpers.getScopeIds([id]).map((id) => _helpers.getCache(id)),\n        ].filter(Boolean)\n\n        needToDrop.forEach((cache) => {\n          cache.willDrop = true\n        })\n        nextTick(() => _helpers.dropScopeByIds([id]))\n      } else {\n        cache.willDrop = true\n        nextTick(() => _helpers.dropById(id))\n      }\n    }\n\n    // 触发 willUnactivate 生命周期\n    run(this, LIFECYCLE_UNACTIVATE)\n  }\n\n  render() {\n    return (\n      <div\n        key=\"keep-alive-placeholder\"\n        nodeKeyIgnore\n        className=\"ka-wrapper\"\n        ref={(node) => {\n          this.placeholder = node\n        }}\n      />\n    )\n  }\n}\n\n// 兼容 SSR 服务端渲染\nfunction SSRKeepAlive({ children }) {\n  return (\n    <div key=\"keep-alive-placeholder\" nodeKeyIgnore className=\"ka-wrapper\">\n      <div key=\"keeper-container\" nodeKeyIgnore className=\"ka-content\">\n        {children}\n      </div>\n    </div>\n  )\n}\n\nexport default isFunction(get(root, 'document.getElementById'))\n  ? expandKeepAlive(withActivation(KeepAlive))\n  : SSRKeepAlive\n"],"names":["isRegExp","val","RegExp","aliveScopeContext","createContext","AliveScopeProvider","Provider","AliveScopeConsumer","Consumer","aliveNodeContext","AliveNodeProvider","AliveNodeConsumer","eventBus","FakeScopeProvider","props","currentContextValue","value","nextProps","emit","children","Component","undefined","FakeScopeConsumer","context","nextContextValue","setState","on","updateListener","off","state","PureComponent","useScopeContext","useContext","scopeReactContext","useState","setContext","useEffect","fakeContextEventBus","React","AliveScopeReactProvider","AliveScopeReactConsumer","reactContext","Suspender","freeze","promiseCache","promise","Promise","resolve","Fragment","Freeze","placeholder","Suspense","fixedContext","updateListenerCache","Map","fixContext","ctx","includes","push","setTimeout","defaultValue","calculateChangedBits","createReactContext","tryFixCtx","type","override","configs","forEach","host","methods","method","originMethod","bind","args","_overridden","autoFixContext","err","console","warn","ProviderBridge","ctxValues","length","ctxValue","onUpdate","unmount","restValues","nextChildren","ConsumerWrapper","id","get","fn","ctxInfo","updator","set","prevValue","shouldUpdate","renderWrapper","renderContent","ctx$$","fixedContextSnapshot","RecursiveConsumerBridge","renderChildren","reduce","render","isSupported","lazy","SusNotSupported","Lazy","FallbackListener","SuspenseBridge","sus$$","onSuspenseStart","onSuspenseEnd","LazyBridge","suspense","ErrorBoundaryBridge","error","throwError","error$$","ErrorThrower","cb","Bridge","bridgeProps","Acceptor","ConsumerBridge","LIFECYCLE_ACTIVATE","LIFECYCLE_UNACTIVATE","withActivation","WrappedComponent","HOC","drop","forwardedRef","attach","ref","every","lifecycleName","current","prototype","componentDidMount","_componentDidMount","call","forwardRef","ForwardedRefHOC","hoistStatics","useActivation","funcName","func","useRef","some","useActivate","useUnactivate","ReactFreeze","Keeper","rest","nextState","callback","unmounted","listeners","isKeepAlive","store","cache","aliveNodesId","Set","delay","timeout","scope","clearTimeout","willDrop","nodes","helpers","smartForceUpdate","canDrop","canRefresh","safeSetState","key","Math","random","node","wrapper","has","e","inited","cached","keepers","appendChild","freezeTimeout","listener","reverse","contextValue","Children","map","child","idx","cloneElement","HANDLE_TYPE_DROP","HANDLE_TYPE_REFRESH","AliveScope","forceUpdate","updateCallbackList","debouncedForceUpdate","params","keeper","isNew","now","Date","createTime","updateTime","update","then","name","getCachingNodes","filter","test","ids","getCachingNodesId","getCache","size","handleNodes","getScopeIds","getCachingNodesByName","dropScopeByIds","refreshScopeByIds","nodesId","handleKeepers","all","responses","Boolean","values","keep","dropScope","dropById","refresh","refreshScope","refreshById","clear","getNode","display","controllerCherryPick","controller","expandKeepAlive","KeepAlive","idPrefix","isOutsideAliveScope","_nk","cacheKey","nkId","HookExpand","WithExpand","withAliveScope","HookScope","WithScope","HOCWithAliveScope","useAliveController","isScrollableNode","scrollWidth","clientWidth","scrollHeight","clientHeight","getScrollableNodes","from","saveScrollPosition","saver","x","scrollLeft","y","scrollTop","revert","body","screenScrollingElement","getErrorTips","parseWhenResult","res","updateTimes","needForceStopUpdate","errorTips","releaseUpdateTimes","didActivate","_helpers","revertScrollPos","willUnactivate","nodesNeedToSaveScrollPosition","flag","removeChild","getInstance","inject","init","when","calcWhen","isScope","eject","needToDrop","SSRKeepAlive"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACO,IAAMA,QAAQ,GAAG,SAAXA,QAAW,CAACC,GAAD;EAAA,OAASA,GAAG,YAAYC,MAAxB;AAAA,CAAjB;;ACEA,IAAMC,iBAAiB,GAAGC,eAAa,EAAvC;AACA,IACKC,kBADL,GAGHF,iBAHG,CACLG,QADK;AAAA,IAEKC,kBAFL,GAGHJ,iBAHG,CAELK,QAFK;AAMA,IAAMC,gBAAgB,GAAGL,eAAa,EAAtC;AACA,IACKM,iBADL,GAGHD,gBAHG,CACLH,QADK;AAAA,IAEKK,iBAFL,GAGHF,gBAHG,CAELD,QAFK;;ACRA,IAAMI,QAAQ,GAAG,eAAjB;AAEP,IAAaC,iBAAb;EAAA;;EAAA;;EAIE,2BAAYC,KAAZ,EAAmB;IAAA;;IAAA;;IACjB,0BAAMA,KAAN;IACAD,iBAAiB,CAACE,mBAAlB,GAAwCD,KAAK,CAACE,KAA9C;IAFiB;;;EAJrB;IAAA;IAAA,OASE,+BAAsBC,SAAtB,EAAiC;MAC/B,IAAIA,SAAS,CAACD,KAAV,KAAoB,KAAKF,KAAL,CAAWE,KAAnC,EAA0C;QACxCH,iBAAiB,CAACE,mBAAlB,GAAwCE,SAAS,CAACD,KAAlD;QACAJ,QAAQ,CAACM,IAAT,CAAc,QAAd,EAAwBD,SAAS,CAACD,KAAlC;;;MAGF,OACEC,SAAS,CAACE,QAAV,KAAuB,KAAKL,KAAL,CAAWK,QAAlC,IACAF,SAAS,CAACD,KAAV,KAAoB,KAAKF,KAAL,CAAWE,KAFjC;;;IAfJ;IAAA,OAqBE,kBAAS;MACP,IAAQG,QAAR,GAAqB,KAAKL,KAA1B,CAAQK,QAAR;MACA,OAAOA,QAAP;;;;EAvBJ;AAAA,EAAuCC,eAAvC;;gBAAaP,+BACOD;;gBADPC,0CAEkBQ;;AAyB/B,IAAaC,iBAAb;EAAA;;EAAA;;EAKE,2BAAYR,KAAZ,EAAmB;IAAA;;IAAA;;IACjB,4BAAMA,KAAN;;IADiB,yDAJX;MACNS,OAAO,EAAEV,iBAAiB,CAACE;KAGV;;IAAA,kEAKF,UAAS,UAACS,gBAAD,EAAsB;MAC9C,OAAKC,QAAL,CAAc;QACZF,OAAO,EAAEC;OADX;KADe,CALE;;IAEjBZ,QAAQ,CAACc,EAAT,CAAY,QAAZ,EAAsB,OAAKC,cAA3B;IAFiB;;;EALrB;IAAA;IAAA,OAgBE,gCAAuB;MACrBf,QAAQ,CAACgB,GAAT,CAAa,QAAb,EAAuB,KAAKD,cAA5B;;;IAjBJ;IAAA,OAoBE,kBAAS;MACP,IAAQR,QAAR,GAAqB,KAAKL,KAA1B,CAAQK,QAAR;MACA,IAAQI,OAAR,GAAoB,KAAKM,KAAzB,CAAQN,OAAR;MACA,OAAO,KAAIJ,QAAJ,EAAcE,SAAd,EAAyBE,OAAzB,CAAP;;;;EAvBJ;AAAA,EAAuCO,mBAAvC;;;;ACdA,AAAO,IAAMC,eAAe,GAAG,SAAlBA,eAAkB,GAAM;EACnC,IAAI,CAAC,YAAWC,gBAAX,CAAL,EAA6B;IAC3B,OAAO,EAAP;;;EAGF,IAAMC,iBAAiB,GAAGD,gBAAU,CAAC7B,iBAAD,CAApC;;EAEA,IAAI8B,iBAAJ,EAAuB;IACrB,OAAOA,iBAAP;;;EAGF,gBAA8BC,cAAQ,CAACrB,iBAAiB,CAACE,mBAAnB,CAAtC;;MAAOQ,OAAP;MAAgBY,UAAhB;;EAEAC,eAAS,CAAC,YAAM;IACd,IAAMT,cAAc,GAAG,UAASQ,UAAT,CAAvB;;IACAE,QAAmB,CAACX,EAApB,CAAuB,QAAvB,EAAiCC,cAAjC;IACA,OAAO;MAAA,OAAMU,QAAmB,CAACT,GAApB,CAAwB,QAAxB,EAAkCD,cAAlC,CAAN;KAAP;GAHO,EAIN,EAJM,CAAT;EAMA,OAAOJ,OAAP;AACD,CApBM;AAsBP,AAAO,IAAMlB,oBAAkB,GAAG,SAArBA,oBAAqB;EAAA,IAAGc,QAAH,QAAGA,QAAH;MAAgBL,KAAhB;;EAAA,oBAChCwB,6BAACC,kBAAD,eAA6BzB,KAA7B;IAAA;mBACEwB,6BAAC,iBAAD,eAAuBxB,KAAvB;IAAA;MAA+BK,QAA/B,CADF,CADgC;AAAA,CAA3B;AAKP,AAAO,IAAMZ,oBAAkB,GAAG,SAArBA,oBAAqB;EAAA,IAAGY,QAAH,SAAGA,QAAH;EAAA,oBAChCmB,6BAACE,kBAAD;IAAA;KACG,UAACC,YAAD;IAAA,OACC,CAAC,CAACA,YAAF,GACE,KAAItB,QAAJ,EAAcE,SAAd,EAAyBoB,YAAzB,CADF,gBAGEH,6BAAC,iBAAD;MAAA;OAAoBnB,QAApB,CAJH;GADH,CADgC;AAAA,CAA3B;;ACxCP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;IAEMuB;;;;;;;;;;;;;;;;mEACW;;;;;;;WACf,kBAAS;MACP,kBAA6B,KAAK5B,KAAlC;UAAQ6B,MAAR,eAAQA,MAAR;UAAgBxB,QAAhB,eAAgBA,QAAhB;MACA,IAAQyB,YAAR,GAAyB,IAAzB,CAAQA,YAAR;;MAEA,IAAID,MAAM,IAAI,CAACC,YAAY,CAACC,OAA5B,EAAqC;QACnCD,YAAY,CAACC,OAAb,GAAuB,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;UAC9CH,YAAY,CAACG,OAAb,GAAuBA,OAAvB;SADqB,CAAvB;QAGA,MAAMH,YAAY,CAACC,OAAnB;OAJF,MAKO,IAAIF,MAAJ,EAAY;QACjB,MAAMC,YAAY,CAACC,OAAnB;OADK,MAEA,IAAID,YAAY,CAACC,OAAjB,EAA0B;QAC/BD,YAAY,CAACG,OAAb;QACAH,YAAY,CAACC,OAAb,GAAuBxB,SAAvB;;;MAGF,oBAAOiB,6BAACU,cAAD,QAAW7B,QAAX,CAAP;;;;;EAlBoBC;;AAsBxB,AAAe,SAAS6B,MAAT,OAA0D;EAAA,IAAxCN,MAAwC,QAAxCA,MAAwC;MAAhCxB,QAAgC,QAAhCA,QAAgC;8BAAtB+B,WAAsB;MAAtBA,WAAsB,iCAAR,IAAQ;EACvE,oBACEZ,6BAACa,cAAD;IAAU,QAAQ,EAAED,WAApB;IAAA;kBACEZ,6BAAC,SAAD;IAAW,MAAM,EAAEK,MAAnB;IAAA;KAA4BxB,QAA5B,CADF,CADF;AAKD;;AC3CM,IAAMiC,YAAY,GAAG,EAArB;AACP,AAAO,IAAMC,mBAAmB,GAAG,IAAIC,GAAJ,EAA5B;AACP,AAAO,IAAM1C,UAAQ,GAAG,eAAjB;AAEP,IAAa2C,UAAU,GAAG,SAAQ,UAACC,GAAD,EAAS;EACzC,IAAI,CAAC,SAAQA,GAAR,CAAL,EAAmB;IACjB;GAFuC;;;EAMzC,IAAI,CAACrD,iBAAD,EAAoBM,gBAApB,EAAsCgD,QAAtC,CAA+CD,GAA/C,CAAJ,EAAyD;IACvD;;;EAEFJ,YAAY,CAACM,IAAb,CAAkBF,GAAlB;EACAG,UAAU,CAAC;IAAA,OAAM/C,UAAQ,CAACM,IAAT,CAAc,QAAd,CAAN;GAAD,CAAV;AACD,CAXyB,CAAnB;AAaP,IAAad,aAAa,GAAG,SAAhBA,aAAgB,CAACwD,YAAD,EAAeC,oBAAf,EAAwC;EACnE,IAAML,GAAG,GAAGM,eAAkB,CAACF,YAAD,EAAeC,oBAAf,CAA9B;EAEAN,UAAU,CAACC,GAAD,CAAV;EACA,OAAOA,GAAP;AACD,CALM;;AAOP,IAAMO,SAAS,GAAG,SAAQ,UAACC,IAAD,EAAU;;EAElC,IAAMR,GAAG,GAAG,KAAIQ,IAAJ,EAAU,UAAV,KAAyB,KAAIA,IAAJ,EAAU,SAAV,CAArC,CAFkC;;;;EAKlC,IAAI,KAAIR,GAAJ,EAAS,UAAT,MAAyB,KAAIrD,iBAAJ,EAAuB,UAAvB,CAA7B,EAAiE;IAC/DoD,UAAU,CAACC,GAAD,CAAV;;AAEH,CARiB,CAAlB;;AAUA,IAAMS,QAAQ,GAAG,SAAXA,QAAW,CAACC,OAAD,EAAa;EAC5BA,OAAO,CAACC,OAAR,CAAgB,gBAAwB;IAAA;QAAtBC,IAAsB;QAAbC,OAAa;;IACtCA,OAAO,CAACF,OAAR,CAAgB,UAACG,MAAD,EAAY;MAC1B,IACE,CAAC,YAAW,KAAIF,IAAJ,EAAUE,MAAV,CAAX,CAAD,IACA,KAAIF,IAAJ,EAAU,CAACE,MAAD,EAAS,aAAT,CAAV,CAFF,EAGE;QACA;;;MAEF,IAAMC,YAAY,GAAGH,IAAI,CAACE,MAAD,CAAJ,CAAaE,IAAb,CAAkBJ,IAAlB,CAArB;;MACAA,IAAI,CAACE,MAAD,CAAJ,GAAe,UAACN,IAAD,EAAmB;QAChC,IAAI,CAAC,UAASA,IAAT,CAAL,EAAqB;UACnBD,SAAS,CAACC,IAAD,CAAT;;;QAF8B,kCAATS,IAAS;UAATA,IAAS;;;QAIhC,OAAOF,YAAY,MAAZ,UAAaP,IAAb,SAAsBS,IAAtB,EAAP;OAJF;;MAMAL,IAAI,CAACE,MAAD,CAAJ,CAAaI,WAAb,GAA2B,IAA3B;KAdF;GADF;AAkBD,CAnBD;AAqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,IAAaC,cAAc,GAAG,SAAjBA,cAAiB,GAAgB;EAC5C,IAAI;IAAA,mCAD4BT,OAC5B;MAD4BA,OAC5B;;;IACFD,QAAQ,CAACC,OAAD,CAAR;GADF,CAEE,OAAOU,GAAP,EAAY;IACZC,OAAO,CAACC,IAAR,CAAa,6BAAb,EAA4CF,GAA5C;;AAEH,CANM;AAQPD,cAAc,CAAC,CAACrC,cAAD,EAAQ,eAAR,CAAD,CAAd;;;;IChFqByC;;;;;EAEnB,wBAAYjE,KAAZ,EAAmB;IAAA;;IAAA;;IACjB,0BAAMA,KAAN;;IADiB,0DADT,IACS;;IAGjB,IAAekE,SAAf,GAA6BlE,KAA7B,CAAQE,KAAR;;IAEA,IAAIgE,SAAS,CAACC,MAAV,KAAqB,CAAzB,EAA4B;MAC1B,MAAKpD,KAAL,GAAa;QACXqD,QAAQ,EAAE;OADZ;MAIA;;;IAGF,gCAAmCF,SAAnC;;QAASxB,GAAT,eAASA,GAAT;QAAcxC,KAAd,eAAcA,KAAd;QAAqBmE,QAArB,eAAqBA,QAArB;;IAEA,MAAKtD,KAAL,GAAa;MACXqD,QAAQ,EAAElE;KADZ;IAIA,MAAKoE,OAAL,GAAeD,QAAQ,CAAC,UAACnE,KAAD,EAAW;MACjC,MAAKS,QAAL,CAAc;QACZyD,QAAQ,EAAElE;OADZ;KADqB,CAAvB;IAnBiB;;;;;WA0BnB,gCAAuB;MACrB,KAAI,KAAKoE,OAAT;;;;;;;WAOF,kBAAS;MACP,kBAAuC,KAAKtE,KAA5C;UAAekE,SAAf,eAAQhE,KAAR;UAA0BG,QAA1B,eAA0BA,QAA1B;;MAEA,IAAI6D,SAAS,CAACC,MAAV,KAAqB,CAAzB,EAA4B;QAC1B,OAAO9D,QAAP;;;MAGF,IAAQ+D,QAAR,GAAqB,KAAKrD,KAA1B,CAAQqD,QAAR;;MACA,2BAAiCF,SAAjC;UAASxB,GAAT,kBAASA,GAAT;UAAmB6B,UAAnB;;MACA,IAAQ/E,QAAR,GAAqBkD,GAArB,CAAQlD,QAAR;MAEA,IAAMgF,YAAY,GAAG,CAAC,aAAYJ,QAAZ,CAAD,gBACnB5C,6BAAC,QAAD;QAAU,KAAK,EAAE4C,QAAjB;QAAA;SAA4B/D,QAA5B,CADmB,GAGnBA,QAHF,CAXO;;;MAmBP,OAAOkE,UAAU,CAACJ,MAAX,GAAoB,CAApB,gBACL3C,6BAAC,cAAD;QAAgB,KAAK,EAAE+C,UAAvB;QAAA;SAAoCC,YAApC,CADK,GAGLA,YAHF;;;;;EAvDwCxD;;ICIvByD;;;;;EAGnB,yBAAYzE,KAAZ,EAAmB;IAAA;;IAAA;;IACjB,0BAAMA,KAAN;;IADiB,iEAFF,IAEE;;IAAA,0DADT,IACS;;IAGjB,IAAQE,KAAR,GAA2BF,KAA3B,CAAQE,KAAR;QAAewC,GAAf,GAA2B1C,KAA3B,CAAe0C,GAAf;QAAoBgC,EAApB,GAA2B1E,KAA3B,CAAoB0E,EAApB;;IACA,IAAI,aAAYxE,KAAZ,CAAJ,EAAwB;MACtB;KALe;;;;;IAWjB,MAAKW,cAAL,GAAsB,KAAI0B,mBAAmB,CAACoC,GAApB,CAAwBjC,GAAxB,CAAJ,EAAkCgC,EAAlC,EAAsC,IAAIlC,GAAJ,EAAtC,CAAtB;;IACA,KAAI,MAAK3B,cAAT,EAAyB,SAAzB,EAAoC,UAAC+D,EAAD;MAAA,OAAQA,EAAE,CAAC1E,KAAD,CAAV;KAApC;;IACA,MAAK2E,OAAL,GAAe;MACbnC,GAAG,EAAHA,GADa;MAEbxC,KAAK,EAALA,KAFa;;MAIbmE,QAAQ,EAAE,kBAACS,OAAD,EAAa;QACrB,MAAKjE,cAAL,CAAoBkE,GAApB,CAAwBD,OAAxB,EAAiCA,OAAjC,EADqB;;;QAIrB,OAAO;UAAA,OAAM,MAAKjE,cAAL,WAA2BiE,OAA3B,CAAN;SAAP;;KARJ;IAbiB;;;;;WA0BnB,gCAAuB;MACrB,kBAA2B,KAAK9E,KAAhC;UAAQE,KAAR,eAAQA,KAAR;UAAewC,GAAf,eAAeA,GAAf;UAAoBgC,EAApB,eAAoBA,EAApB;;MACA,IAAI,aAAYxE,KAAZ,CAAJ,EAAwB;QACtB;OAHmB;;;;MAQrBqC,mBAAmB,CAACwC,GAApB,CAAwBrC,GAAxB,oCACK,KAAIH,mBAAmB,CAACoC,GAApB,CAAwBjC,GAAxB,CAAJ,EAAkCnC,SAAlC,EAA6C,EAA7C,CADL,2BAEGmE,EAFH,EAEQ,KAAK7D,cAFb;;;;;;WAQF,qCAAiC;MAAA,IAATX,KAAS,QAATA,KAAS;MAC/B,IAAe8E,SAAf,GAA6B,KAAKhF,KAAlC,CAAQE,KAAR;MACA,IAAM+E,YAAY,GAAGD,SAAS,KAAK9E,KAAnC;;MAEA,IAAI+E,YAAJ,EAAkB;QAChB,KAAI,KAAKpE,cAAT,EAAyB,SAAzB,EAAoC,UAAC+D,EAAD;UAAA,OAAQA,EAAE,CAAC1E,KAAD,CAAV;SAApC;;;MAGF,OAAO,IAAP;;;;WAGF,kBAAS;MAAA;;MACP,mBAAoD,KAAKF,KAAzD;UAAQE,KAAR,gBAAQA,KAAR;UAAegF,aAAf,gBAAeA,aAAf;UAA8BC,aAA9B,gBAA8BA,aAA9B;UAA6CT,EAA7C,gBAA6CA,EAA7C;MAEA,OAAOQ,aAAa,CAAC,UAACE,KAAD;QAAA,OACnBD,aAAa,CAAC,aAAYjF,KAAZ,IAAqBkF,KAArB,gCAAiCA,KAAjC,IAAwC,MAAI,CAACP,OAA7C,EAAD,CADM;OAAD,CAApB;;;;;EA3DyCvE;;;ACM7C,IAAM+E,oBAAoB,GAAG,EAA7B;;IAGMC;;;;;EACJ,iCAAYtF,KAAZ,EAAmB;IAAA;;IAAA;;IACjB,0BAAMA,KAAN;;IADiB,gEASH,UAACuF,cAAD,EAAoB;MAClC,IAAQb,EAAR,GAAe,MAAK1E,KAApB,CAAQ0E,EAAR;MAEA,IAAMQ,aAAa,GAAGG,oBAAoB,CAACX,EAAD,CAApB,CAAyBc,MAAzB,CACpB,UAACC,MAAD,EAAS/C,GAAT,EAAiB;QACf,IAAQhD,QAAR,GAAqBgD,GAArB,CAAQhD,QAAR;;QAEA,IAAMwF,aAAa,GAAG,SAAhBA,aAAgB,CAACC,aAAD;UAAA,oBACpB3D,6BAAC,QAAD;YAAA;aACG,UAACtB,KAAD;YAAA,oBACCsB,6BAAC,eAAD;cAEItB,KAAK,EAALA,KAFJ;cAGIwC,GAAG,EAAHA,GAHJ;cAIIwC,aAAa,EAAEO,MAJnB;cAKIN,aAAa,EAAbA,aALJ;cAMIT,EAAE,EAAFA,EANJ;cAAA;cADD;WADH,CADoB;SAAtB;;QAgBA,OAAOQ,aAAP;OApBkB,EAsBpB,UAACC,aAAD;QAAA,OAAmBA,aAAa,CAAC,EAAD,CAAhC;OAtBoB,CAAtB;MAyBA,OAAOD,aAAa,CAACK,cAAD,CAApB;KArCiB;;IAEjB,IAAQb,GAAR,GAAe1E,KAAf,CAAQ0E,EAAR;;IAEA,IAAI,CAACW,oBAAoB,CAACX,GAAD,CAAzB,EAA+B;MAC7BW,oBAAoB,CAACX,GAAD,CAApB,sBAA+BpC,YAA/B;;;IALe;;;;;WAwCnB,kBAAS;MACP,IAAkBiD,cAAlB,GAAqC,KAAKvF,KAA1C,CAAQK,QAAR;MAEA,OAAO,KAAK6E,aAAL,CAAmBK,cAAnB,CAAP;;;;;EA5CkCvE;;;ACbtC;AACA,IAAM0E,WAAW,GAAG,YAAWC,UAAX,KAAoB,CAAC,aAAYtD,cAAZ,CAAzC;;AACA,IAAMuD,eAAe,GAAG,SAAlBA,eAAkB;EAAA,IAAGvF,QAAH,QAAGA,QAAH;EAAA,OAAkB,KAAIA,QAAJ,CAAlB;AAAA,CAAxB;;AAEA,IAAMwF,IAAI,GAAGH,WAAW,gBAAGC,UAAI,CAAC;EAAA,OAAM,IAAI3D,OAAJ,CAAY;IAAA,OAAM,IAAN;GAAZ,CAAN;AAAA,CAAD,CAAP,GAAyC;EAAA,OAAM,IAAN;AAAA,CAAjE;;IAEM8D;;;;;;;;;;;;;WACJ,6BAAoB;MAClB,KAAI,KAAK9F,KAAT,EAAgB,SAAhB;;;;WAGF,gCAAuB;MACrB,KAAI,KAAKA,KAAT,EAAgB,OAAhB;;;;WAGF,kBAAS;MACP,OAAO,IAAP;;;;;EAV2BM;;AAc/B,SAASyF,cAAT,QAA6C;EAAA,IAAnB1F,QAAmB,SAAnBA,QAAmB;MAAT2F,KAAS,SAATA,KAAS;EAC3C;;;IAEExE,6BAACa,cAAD;MACE,QAAQ,eACNb,6BAAC,gBAAD;QACE,OAAO,EAAEwE,KAAK,CAACC,eADjB;QAEE,KAAK,EAAED,KAAK,CAACE,aAFf;QAAA;QAFJ;MAAA;OAQG7F,QARH;;AAWH;;AAED,AAAO,IAAM8F,UAAU,GAAGT,WAAW;EAAA;;EAAA;;EAAA;IAAA;;IAAA;;IAAA;MAAA;;;IAAA;;IAAA,wDAEvB;MACNU,QAAQ,EAAE;KAHmB;;IAAA,kEAMb,YAAM;MACtB,MAAKzF,QAAL,CAAc;QACZyF,QAAQ,EAAE;OADZ;KAP6B;;IAAA,gEAYf,YAAM;MACpB,MAAKzF,QAAL,CAAc;QACZyF,QAAQ,EAAE;OADZ;KAb6B;;IAAA,wDAkBvB;MACNH,eAAe,EAAE,MAAKA,eADhB;MAENC,aAAa,EAAE,MAAKA;KApBS;;IAAA;;;EAAA;IAAA;IAAA,OAuB/B,kBAAS;MACP,IAAQ7F,QAAR,GAAqB,KAAKL,KAA1B,CAAQK,QAAR;MAEA,oBACEmB,6BAACU,cAAD,QACG,KAAI7B,QAAJ,EAAcE,SAAd,EAAyB,KAAKyF,KAA9B,CADH,EAGG,KAAKjF,KAAL,CAAWqF,QAAX,iBAAuB5E,6BAAC,IAAD;QAAA;QAH1B,CADF;;;;EA1B6B;AAAA,EACRlB,eADQ,IAmCjCsF,eAnCG;AAqCP,uBAAeF,WAAW,GAAGK,cAAH,GAAoBH,eAA9C;;ICzEqBS;;;;;;;;;;;;;;IAGnB,2BAAkBC,KAAlB,EAAyB;MACvB,IAAiBC,UAAjB,GAAgC,KAAKvG,KAArC,CAAQwG,OAAR;;MAEA,KAAID,UAAJ,EAAgBhG,SAAhB,EAA2B+F,KAA3B,EAAkC,YAAM;QACtC,KAAIC,UAAJ,EAAgBhG,SAAhB,EAA2B,IAA3B;OADF;;;;WAKF,kBAAS;MACP,OAAO,KAAKP,KAAL,CAAWK,QAAlB;;;;;EAZ6CC;;gBAA5B+F,iDAEe;EAAA,OAAM,IAAN;AAAA;IAcvBI,YAAb;EAAA;;EAAA;;EAAA;IAAA;;IAAA;;IAAA;MAAA;;;IAAA;;IAAA,wDACU;MACNH,KAAK,EAAE;KAFX;;IAAA,6DAKe,UAACA,KAAD,EAAQI,EAAR;MAAA,OAAe,MAAK/F,QAAL,CAAc;QAAE2F,KAAK,EAALA;OAAhB,EAAyBI,EAAzB,CAAf;KALf;;IAAA;;;EAAA;IAAA;IAAA,OAME,kBAAS;MACP,IAAI,KAAK3F,KAAL,CAAWuF,KAAf,EAAsB;QACpB,MAAM,KAAKvF,KAAL,CAAWuF,KAAjB;;;MAGF,OAAO,KAAI,KAAKtG,KAAL,CAAWK,QAAf,EAAyBE,SAAzB,EAAoC,KAAKgG,UAAzC,CAAP;;;;EAXJ;AAAA,EAAkCjG,eAAlC;;;ACXA,AAAe,SAASqG,MAAT,OAA+C;EAAA,IAA7BjC,EAA6B,QAA7BA,EAA6B;MAAzBrE,QAAyB,QAAzBA,QAAyB;MAAfuG,WAAe,QAAfA,WAAe;EAC5D,IAAQZ,KAAR,GAAkCY,WAAlC,CAAQZ,KAAR;MAAeZ,KAAf,GAAkCwB,WAAlC,CAAexB,KAAf;MAAsBoB,OAAtB,GAAkCI,WAAlC,CAAsBJ,OAAtB;EAEA;;;;IAEEhF,6BAAC,mBAAD;MAAqB,OAAO,EAAEgF,OAA9B;MAAA;oBAEEhF,6BAACuE,gBAAD;MAAgB,KAAK,EAAEC,KAAvB;MAAA;oBAEExE,6BAAC,cAAD;MAAgB,EAAE,EAAEkD,EAApB;MAAwB,KAAK,EAAEU,KAA/B;MAAA;OACG/E,QADH,CAFF,CAFF;;AAUH;;AAGD,AAAO,SAASwG,QAAT,QAAoC;EAAA,IAAhBnC,EAAgB,SAAhBA,EAAgB;MAAZrE,QAAY,SAAZA,QAAY;EACzC;;;;IAEEmB,6BAAC,YAAD;MAAA;OACG,UAACgF,OAAD;MAAA;;;;QAEChF,6BAAC,UAAD;UAAA;WACG,UAACwE,KAAD;UAAA;;;;YAECxE,6BAACsF,uBAAD;cAAgB,EAAE,EAAEpC,EAApB;cAAA;eACG,UAACU,KAAD;cAAA,OACC,KAAI/E,QAAJ,EAAcE,SAAd,EAAyB;gBACvBqG,WAAW,EAAE;kBACXZ,KAAK,EAALA,KADW;kBAEXZ,KAAK,EAALA,KAFW;kBAGXoB,OAAO,EAAPA;;eAJJ,CADD;aADH;;SAHJ;;KAHJ;;AAsBH;;;;AC/BD,AAAO,IAAMO,kBAAkB,GAAG,sBAA3B;AACP,AAAO,IAAMC,oBAAoB,GAAG,yBAA7B;AAEP,IAAaC,cAAc,GAAG,SAAjBA,cAAiB,CAACC,gBAAD,EAAsB;EAAA,IAC5CC,GAD4C;IAAA;;IAAA;;IAAA;MAAA;;MAAA;;MAAA;QAAA;;;MAAA;;MAAA,uDAEzC,IAFyC;;MAAA;;;IAAA;MAAA;MAAA,OAIhD,gCAAuB;QACrB,KAAI,KAAKC,IAAT;;;MAL8C;MAAA,OAQhD,kBAAS;QAAA;;QACP,kBAAmC,KAAKpH,KAAxC;YAAQqH,YAAR,eAAQA,YAAR;YAAyBrH,KAAzB;;QAEA,oBACEwB,6BAAC,iBAAD;UAAA;WACG;UAAA,+EAAc,EAAd;cAAG8F,MAAH,QAAGA,MAAH;;UAAA,oBACC9F,6BAAC,gBAAD;YACE,GAAG,EAAE,aAAC+F,KAAD,EAAS;cACZ,IACE,CAACR,kBAAD,EAAqBC,oBAArB,EAA2CQ,KAA3C,CACE,UAACC,aAAD;gBAAA,OAAmB,CAAC,YAAW,KAAIF,KAAJ,EAASE,aAAT,CAAX,CAApB;eADF,CADF,EAIE;gBACA;;;cAEF,MAAI,CAACL,IAAL,GAAY,KAAIE,MAAJ,EAAY/G,SAAZ,EAAuBgH,KAAvB,CAAZ,CARY;;cAWZ,IAAI,aAAYF,YAAZ,CAAJ,EAA+B;gBAC7B;;;cAGF,IAAI,UAASA,YAAT,KAA0B,aAAaA,YAA3C,EAAyD;gBACvDA,YAAY,CAACK,OAAb,GAAuBH,KAAvB;gBACA;;;cAGF,KAAIF,YAAJ,EAAkB9G,SAAlB,EAA6BgH,KAA7B;;aAEEvH,KAvBN;YAAA;aADD;SADH,CADF;;;;IAX8C;IAChCM,eADgC;;;;;;EAkDlD,IAAI,YAAW4G,gBAAgB,CAACS,SAAjB,CAA2BC,iBAAtC,CAAJ,EAA8D;IAC5DV,gBAAgB,CAACS,SAAjB,CAA2BE,kBAA3B,GACEX,gBAAgB,CAACS,SAAjB,CAA2BC,iBAD7B;;IAEAV,gBAAgB,CAACS,SAAjB,CAA2BC,iBAA3B,GAA+C,SAASA,iBAAT,GAA6B;MAAA;;MAC1E,UAAS;QAAA,OAAMV,gBAAgB,CAACS,SAAjB,CAA2BE,kBAA3B,CAA8CC,IAA9C,CAAmD,MAAnD,CAAN;OAAT;KADF;;;EAKF,IAAI,YAAWC,gBAAX,CAAJ,EAA4B;IAC1B,IAAMC,eAAe,gBAAGD,gBAAU,CAAC,UAAC/H,KAAD,EAAQuH,GAAR;MAAA,oBACjC/F,6BAAC,GAAD,eAASxB,KAAT;QAAgB,YAAY,EAAEuH,GAA9B;QAAA;SADiC;KAAD,CAAlC;IAIA,OAAOU,YAAY,CAACD,eAAD,EAAkBd,gBAAlB,CAAnB;GALF,MAMO;IACL,OAAOe,YAAY,CAACd,GAAD,EAAMD,gBAAN,CAAnB;;AAEH,CAnEM;;AAqEP,IAAMgB,aAAa,GAAG,SAAhBA,aAAgB,CAACC,QAAD,EAAWC,IAAX,EAAoB;;EAExC,IAAI,CAACC,YAAD,EAASnH,gBAAT,EAAqBI,eAArB,EAAgCgH,IAAhC,CAAqC,UAAC1D,EAAD;IAAA,OAAQ,CAAC,YAAWA,EAAX,CAAT;GAArC,CAAJ,EAAmE;IACjE;;;EAGF,IAAMR,QAAQ,GAAGlD,gBAAU,CAACvB,gBAAD,CAA3B,CANwC;;EASxC,IAAI,CAACyE,QAAL,EAAe;IACb;;;EAGF,cAAyBiE,YAAM,CAAC,EAAD,CAA/B;MAAiBd,GAAjB,WAAQG,OAAR;;EACA,IAAQJ,MAAR,GAAmBlD,QAAnB,CAAQkD,MAAR;EAEAC,GAAG,CAACY,QAAD,CAAH,GAAgBC,IAAhB;EACAb,GAAG,CAACH,IAAJ,GAAWE,MAAM,CAACC,GAAD,CAAjB;EAEAjG,eAAS,CAAC,YAAM;IACd,OAAO;MAAA,OAAM,KAAIiG,GAAG,CAACH,IAAR,CAAN;KAAP;GADO,EAEN,EAFM,CAAT;AAGD,CAtBD;;AAwBA,IAAamB,WAAW,GAAGL,aAAa,CAACxE,IAAd,CAAmB,IAAnB,EAAyBqD,kBAAzB,CAApB;AACP,IAAayB,aAAa,GAAGN,aAAa,CAACxE,IAAd,CAAmB,IAAnB,EAAyBsD,oBAAzB,CAAtB;;;ACrHP;AAQA,IAAM7E,QAAM,GAAG,CAAC,CAACE,cAAF,GAAaoG,MAAb,GAA2B;EAAA,IAAGpI,QAAH,QAAGA,QAAH;EAAA,OAAkBA,QAAlB;AAAA,CAA1C;;IAEqBqI;;;;;EAKnB,gBAAY1I,KAAZ,EAA4B;IAAA;;IAAA;;IAAA,kCAAN2I,IAAM;MAANA,IAAM;;;IAC1B,yCAAM3I,KAAN,SAAgB2I,IAAhB;;IAD0B,2DAJjB,eAIiB;;IAAA,4DAHhB,IAAInG,GAAJ,EAGgB;;IAAA,0DAFlB,IAEkB;;IAAA,wDAWpBjC,SAXoB;;IAAA,4DA4ChB,KA5CgB;;IAAA,+DA6Cb,UAACqI,SAAD,EAAYC,QAAZ,EAAyB;;MAEtC,IAAI,MAAKC,SAAT,EAAoB;QAClB;;;MAEF,MAAKnI,QAAL,CAAciI,SAAd,EAAyBC,QAAzB;KAlD0B;;IAAA,gEAoEZ,IApEY;;IAAA,yDAgHnB,UAACtB,GAAD,EAAS;MAAA;;MAChB,IAAMwB,SAAS,GAAG,MAAKA,SAAvB;;MAEA,IAAI,CAACxB,GAAL,EAAU;QACR,OAAO;UAAA,OAAM,IAAN;SAAP;;;MAGF,IAAIA,GAAG,CAACyB,WAAR,EAAqB;QACnB,UAAS,YAAM;UACb,kBAAsB,MAAKhJ,KAA3B;cAAQ0E,EAAR,eAAQA,EAAR;cAAYuE,KAAZ,eAAYA,KAAZ;UACA,IAAMC,KAAK,GAAGD,KAAK,CAACtE,GAAN,CAAUD,EAAV,CAAd;UACAwE,KAAK,CAACC,YAAN,GAAqB,IAAIC,GAAJ,8BAAYF,KAAK,CAACC,YAAlB,IAAgC5B,GAAG,CAAC7C,EAApC,GAArB;SAHF;;;MAOFqE,SAAS,CAAChE,GAAV,CAAcwC,GAAd,wDACGR,kBADH,EACwB;QAAA,OAAM,KAAIQ,GAAJ,EAASR,kBAAT,CAAN;OADxB,mCAEGC,oBAFH,EAE0B;QAAA,OAAM,KAAIO,GAAJ,EAASP,oBAAT,CAAN;OAF1B,oBAfgB;;MAqBhB,OAAO,YAAM;QACX+B,SAAS,UAAT,CAAiBxB,GAAjB;OADF;KArI0B;;IAAA,+DA2Ib;MACb7C,EAAE,EAAE,MAAK1E,KAAL,CAAW0E,EADF;MAEb4C,MAAM,EAAE,MAAKA;KA7Ia;;IAAA,uDAgJrB;MAAA,gFAAoB,EAApB;8BAAG+B,KAAH;UAAGA,KAAH,4BAAW,IAAX;;MAAA,OACL,IAAIrH,OAAJ,CAAY,UAACC,OAAD,EAAa;QACvB,IAAIqH,OAAJ;QACA,mBAAsB,MAAKtJ,KAA3B;YAAQuJ,KAAR,gBAAQA,KAAR;YAAe7E,EAAf,gBAAeA,EAAf;;QACA,IAAM0C,IAAI,GAAG,SAAPA,IAAO,GAAM;UACjBoC,YAAY,CAACF,OAAD,CAAZ;;UACA,MAAKxJ,QAAL,CAAcgB,GAAd,CAAkBkG,oBAAlB,EAAwCI,IAAxC,EAFiB;;;UAIjB,MAAK8B,KAAL,CAAWO,QAAX,GAAsB,IAAtB;UACAF,KAAK,CAACG,KAAN,WAAmBhF,EAAnB;UACA6E,KAAK,CAACI,OAAN,sBAAqBJ,KAAK,CAACI,OAA3B;UACAJ,KAAK,CAACK,gBAAN,CAAuB;YAAA,OAAM3H,OAAO,CAAC,IAAD,CAAb;WAAvB;SAPF;;QAUA,IAAM4H,OAAO,GAAG,KAAI,MAAKX,KAAT,EAAgB,QAAhB,KAA6B,KAAI,MAAKA,KAAT,EAAgB,UAAhB,CAA7C;;QACA,IAAI,CAACW,OAAL,EAAc;UACZ,MAAK/J,QAAL,CAAcc,EAAd,CAAiBoG,oBAAjB,EAAuCI,IAAvC;;UACAkC,OAAO,GAAGzG,UAAU,CAAC,YAAM;YACzB,MAAK/C,QAAL,CAAcgB,GAAd,CAAkBkG,oBAAlB,EAAwCI,IAAxC;;YACAnF,OAAO,CAAC,KAAD,CAAP;WAFkB,EAGjBoH,KAHiB,CAApB;UAIA;;;QAGFjC,IAAI;OAvBN,CADK;KAhJqB;;IAAA,0DA2KlB;MAAA,OACR,IAAIpF,OAAJ,CAAY,UAACC,OAAD,EAAa;QACvB,IAAM6H,UAAU,GAAG,CAAC,KAAI,MAAKZ,KAAT,EAAgB,QAAhB,CAApB;;QACA,IAAI,CAACY,UAAL,EAAiB;UACf7H,OAAO,CAAC,KAAD,CAAP;;;QAEF,MAAK8H,YAAL,CACE;UACEC,GAAG,EAAEC,IAAI,CAACC,MAAL;SAFT,EAIE;UAAA,OAAMjI,OAAO,CAAC,IAAD,CAAb;SAJF;OALF,CADQ;KA3KkB;;IAG1B,MAAKlB,KAAL,GAAa;MACXV,QAAQ,EAAEL,KAAK,CAACK,QADL;MAEXuG,WAAW,EAAE5G,KAAK,CAAC4G,WAFR;MAGXoD,GAAG,EAAEC,IAAI,CAACC,MAAL,EAHM;MAIXrI,MAAM,EAAE;KAJV;IAH0B;;;;;WAY5B,6BAAoB;MAAA;;;MAClB,mBAAsB,KAAK7B,KAA3B;UAAQiJ,KAAR,gBAAQA,KAAR;UAAevE,EAAf,gBAAeA,EAAf;MACA,IAAMqE,SAAS,GAAG,KAAKA,SAAvB;MACA,IAAMoB,IAAI,GAAG,KAAKC,OAAlB,CAHkB;;MAMlB,IAAInB,KAAK,CAACoB,GAAN,CAAU3F,EAAV,CAAJ,EAAmB;QACjB;;;MAGF,IAAIgF,KAAJ;;MACA,IAAI;QACFA,KAAK,sBAAOS,IAAI,CAAC9J,QAAZ,CAAL;OADF,CAEE,OAAOiK,CAAP,EAAU;QACVZ,KAAK,GAAG,CAACS,IAAI,CAAC9J,QAAN,CAAR;;;MAGF,KAAK6I,KAAL;QACEH,SAAS,EAATA,SADF;QAEEI,YAAY,EAAE,EAFhB;QAGEoB,MAAM,EAAE,KAHV;QAIEC,MAAM,EAAE,KAJV;QAKEJ,OAAO,EAAED,IALX;QAMET,KAAK,EAALA;sCACC3C,kBAPH,EAOwB;QAAA,OAAM,MAAI,CAACA,kBAAD,CAAJ,EAAN;OAPxB,gCAQGC,oBARH,EAQ0B;QAAA,OAAM,MAAI,CAACA,oBAAD,CAAJ,EAAN;OAR1B;MAWAiC,KAAK,CAAClE,GAAN,CAAUL,EAAV,EAAc,KAAKwE,KAAnB;;;;WAYF,gCAAuB;MACrB,mBAA+B,KAAKlJ,KAApC;UAAQiJ,KAAR,gBAAQA,KAAR;UAAewB,OAAf,gBAAeA,OAAf;UAAwB/F,EAAxB,gBAAwBA,EAAxB,CADqB;;MAGrB,IAAI;QACF,IAAMwE,KAAK,GAAGD,KAAK,CAACtE,GAAN,CAAUD,EAAV,CAAd;QACAwE,KAAK,CAACQ,KAAN,CAAYrG,OAAZ,CAAoB,UAAC8G,IAAD,EAAU;UAC5BjB,KAAK,CAACkB,OAAN,CAAcM,WAAd,CAA0BP,IAA1B;SADF;OAFF,CAKE,OAAO7D,KAAP,EAAc;;;MAGhB2C,KAAK,UAAL,CAAavE,EAAb;MACA+F,OAAO,UAAP,CAAe/F,EAAf;MACA,KAAKoE,SAAL,GAAiB,IAAjB;;;SAKA/B;WAAD,iBAAuB;MACtByC,YAAY,CAAC,KAAKmB,aAAN,CAAZ,CADsB;;MAGtB,KAAKZ,YAAL,CAAkB;QAChBlI,MAAM,EAAE;OADV;MAGA,KAAK/B,QAAL,CAAcM,IAAd,CAAmB2G,kBAAnB;MACA,KAAKgC,SAAL,CAAe1F,OAAf,CAAuB,UAACuH,QAAD;QAAA,OAAc,KAAIA,QAAJ,EAAc,CAAC7D,kBAAD,CAAd,CAAd;OAAvB;;;SAGAC;WAAD,iBAAyB;MAAA;;MACxB,KAAKlH,QAAL,CAAcM,IAAd,CAAmB4G,oBAAnB;;MACA,IAAM+B,SAAS,sBAAO,KAAKA,SAAZ,CAAf;;MAEAA,SAAS,CACN8B,OADH,GAEGxH,OAFH,CAEW;QAAA;YAAIuH,QAAJ;;QAAA,OAAkB,KAAIA,QAAJ,EAAc,CAAC5D,oBAAD,CAAd,CAAlB;OAFX,EAJwB;;MASxBwC,YAAY,CAAC,KAAKmB,aAAN,CAAZ;MACA,KAAKA,aAAL,GAAqB9H,UAAU,CAAC,YAAM;QACpC,MAAI,CAACkH,YAAL,CAAkB;UAChBlI,MAAM,EAAE;SADV;OAD6B,EAI5B,IAJ4B,CAA/B;;;;;;;;;;;;;;;;;WA+FF,kBAAS;MAAA;;MACP,mBAAyB,KAAK7B,KAA9B;UAAQ0E,EAAR,gBAAQA,EAAR;UAAe1E,KAAf;;MACA,kBAA+C,KAAKe,KAApD;UAAQV,QAAR,eAAQA,QAAR;UAAkBuG,WAAlB,eAAkBA,WAAlB;UAA+BoD,GAA/B,eAA+BA,GAA/B;UAAoCnI,MAApC,eAAoCA,MAApC;MAEA,oBACEL,6BAACW,QAAD;QAAQ,MAAM,EAAEN,MAAhB;QAAA;sBACEL;QACE,GAAG,EAAE,aAAC2I,IAAD,EAAU;UACb,MAAI,CAACC,OAAL,GAAeD,IAAf;SAFJ;QAAA;sBAKE3I;QAAK,GAAG,EAAC,kBAAT;QAA0C,SAAS,EAAC;sBAClDA,6BAAC,MAAD;QAAQ,EAAE,EAAEkD,EAAZ;QAAgB,WAAW,EAAEkC,WAA7B;QAAA;sBACEpF,6BAAC,iBAAD;QAAmB,KAAK,EAAE,KAAKsJ,YAA/B;QAAA;SACGtJ,cAAK,CAACuJ,QAAN,CAAeC,GAAf,CAAmB3K,QAAnB,EAA6B,UAAC4K,KAAD,EAAQC,GAAR;QAAA,oBAC5B1J,cAAK,CAAC2J,YAAN,CAAmBF,KAAnB,EAA0B;UACxBjB,GAAG,YAAKiB,KAAK,CAACjB,GAAN,IAAa,EAAlB,cAAwBA,GAAxB,cAA+BkB,GAA/B;SADL,CAD4B;OAA7B,CADH,CADF,CADF,CALF,CADF,CADF;;;;;EAlMgClK;;;ACVpC;AAOA,IAAMoK,gBAAgB,GAAG,MAAzB;AACA,IAAMC,mBAAmB,GAAG,SAA5B;;IAEqBC;;;;;;;;;;;;;;;;4DACX,IAAI9I,GAAJ;;4DACA,IAAIA,GAAJ;;8DACE,IAAIA,GAAJ;;2EAEa,UAAS,UAACkE,EAAD;MAAA,OAAQ,MAAK6E,WAAL,CAAiB7E,EAAjB,CAAR;KAAT;;yEACF;;uEACF,UAACA,EAAD,EAAQ;MACzB,MAAK8E,kBAAL,CAAwB5I,IAAxB,CAA6B8D,EAA7B;;MACA,MAAK+E,oBAAL,CAA0B,YAAM;QAC9B,MAAKD,kBAAL,CAAwBnI,OAAxB,CAAgC,UAACqD,EAAD;UAAA,OAAQ,KAAIA,EAAJ,CAAR;SAAhC;;QACA,MAAK8E,kBAAL,GAA0B,EAA1B;OAFF;;;6DAKO,UAAC9G,EAAD,EAAKgH,MAAL;MAAA,OACP,IAAI1J,OAAJ,CAAY,UAACC,OAAD,EAAa;QACvB,IAAM0J,MAAM,GAAG,MAAKlB,OAAL,CAAa9F,GAAb,CAAiBD,EAAjB,CAAf;;QACA,IAAMkH,KAAK,GAAG,CAACD,MAAf;QACA,IAAME,GAAG,GAAGC,IAAI,CAACD,GAAL,EAAZ;QACA,IAAM1B,IAAI,GAAG,MAAKT,KAAL,CAAW/E,GAAX,CAAeD,EAAf,KAAsB,IAAnC;;QACA,MAAKgF,KAAL,CAAW3E,GAAX,CAAeL,EAAf;UACEA,EAAE,EAAFA,EADF;UAEEqH,UAAU,EAAEF,GAFd;UAGEG,UAAU,EAAEH;WACT1B,IAJL,GAKKuB,MALL;;QAQA,IAAIE,KAAJ,EAAW;UACT,MAAKjC,OAAL,sBAAoB,MAAKA,OAAzB;;UAEA,MAAK4B,WAAL,CAAiBtJ,OAAjB;SAHF,MAIO;UACL,IAAQ5B,QAAR,GAAkCqL,MAAlC,CAAQrL,QAAR;cAAkBuG,WAAlB,GAAkC8E,MAAlC,CAAkB9E,WAAlB;UACA+E,MAAM,CAAChL,QAAP,CAAgB;YAAEN,QAAQ,EAARA,QAAF;YAAYuG,WAAW,EAAXA;WAA5B,EAA2C3E,OAA3C;;OAnBJ,CADO;;;2DAwBF,UAACyC,EAAD,EAAKgH,MAAL;MAAA,OACL,IAAI1J,OAAJ,CAAY,UAACC,OAAD,EAAa;QACvB,MAAKgK,MAAL,CAAYvH,EAAZ;UACEA,EAAE,EAAFA;WACGgH,MAFL,GAGGQ,IAHH,CAGQ,YAAM;UACZjK,OAAO,CAAC,MAAKgH,KAAL,CAAWtE,GAAX,CAAeD,EAAf,CAAD,CAAP;SAJF;OADF,CADK;;;4EAUiB,UAACyH,IAAD;MAAA,OACtB,MAAKC,eAAL,GAAuBC,MAAvB,CAA8B,UAAClC,IAAD;QAAA,OAC5BjL,QAAQ,CAACiN,IAAD,CAAR,GAAiBA,IAAI,CAACG,IAAL,CAAUnC,IAAI,CAACgC,IAAf,CAAjB,GAAwChC,IAAI,CAACgC,IAAL,KAAcA,IAD1B;OAA9B,CADsB;;;kEAKV,UAACI,GAAD,EAAS;;MAErB,IAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAAC9H,EAAD,EAAQ;QAChC,IAAMyE,YAAY,GAAG,KAAI,MAAKsD,QAAL,CAAc/H,EAAd,CAAJ,EAAuB,cAAvB,EAAuC,EAAvC,CAArB;;QAEA,IAAIyE,YAAY,CAACuD,IAAb,GAAoB,CAAxB,EAA2B;UACzB,OAAO,CAAChI,EAAD,EAAK,mBAAIyE,YAAJ,EAAkB6B,GAAlB,CAAsBwB,iBAAtB,CAAL,CAAP;;;QAGF,QAAQ9H,EAAR,4BAAeyE,YAAf;OAPF;;MAUA,OAAO,SAAQoD,GAAG,CAACvB,GAAJ,CAAQ,UAACtG,EAAD;QAAA,OAAQ8H,iBAAiB,CAAC9H,EAAD,CAAzB;OAAR,CAAR,CAAP;;;+DAGS,UAACA,EAAD;MAAA;;MAAA,mCAAQiE,IAAR;QAAQA,IAAR;;;MAAA,OAAiB,iBAAKgE,WAAL,gBAAiB,CAACjI,EAAD,CAAjB,EAAuB0G,gBAAvB,SAA4CzC,IAA5C,EAAjB;;;qEACM,UAAC4D,GAAD;MAAA;;MAAA,mCAAS5D,IAAT;QAASA,IAAT;;;MAAA,OACf,iBAAKgE,WAAL,gBAAiB,MAAKC,WAAL,CAAiBL,GAAjB,CAAjB,EAAwCnB,gBAAxC,SAA6DzC,IAA7D,EADe;;;2DAGV,UAACwD,IAAD;MAAA;;MAAA,mCAAUxD,IAAV;QAAUA,IAAV;;;MAAA,OACL,iBAAKgE,WAAL,gBACE,MAAKE,qBAAL,CAA2BV,IAA3B,EAAiCnB,GAAjC,CAAqC,UAACb,IAAD;QAAA,OAAUA,IAAI,CAACzF,EAAf;OAArC,CADF,EAEE0G,gBAFF,SAGKzC,IAHL,EADK;;;gEAOK,UAACwD,IAAD;MAAA;;MAAA,mCAAUxD,IAAV;QAAUA,IAAV;;;MAAA,OACV,iBAAKmE,cAAL,gBACE,MAAKD,qBAAL,CAA2BV,IAA3B,EAAiCnB,GAAjC,CAAqC;QAAA,IAAGtG,EAAH,QAAGA,EAAH;QAAA,OAAYA,EAAZ;OAArC,CADF,SAEKiE,IAFL,EADU;;;kEAME,UAACjE,EAAD;MAAA;;MAAA,mCAAQiE,IAAR;QAAQA,IAAR;;;MAAA,OACZ,iBAAKgE,WAAL,gBAAiB,CAACjI,EAAD,CAAjB,EAAuB2G,mBAAvB,SAA+C1C,IAA/C,EADY;;;wEAEM,UAAC4D,GAAD;MAAA;;MAAA,mCAAS5D,IAAT;QAASA,IAAT;;;MAAA,OAClB,iBAAKgE,WAAL,gBAAiB,MAAKC,WAAL,CAAiBL,GAAjB,CAAjB,EAAwClB,mBAAxC,SAAgE1C,IAAhE,EADkB;;;8DAGV,UAACwD,IAAD;MAAA;;MAAA,mCAAUxD,IAAV;QAAUA,IAAV;;;MAAA,OACR,iBAAKgE,WAAL,gBACE,MAAKE,qBAAL,CAA2BV,IAA3B,EAAiCnB,GAAjC,CAAqC,UAACb,IAAD;QAAA,OAAUA,IAAI,CAACzF,EAAf;OAArC,CADF,EAEE2G,mBAFF,SAGK1C,IAHL,EADQ;;;mEAOK,UAACwD,IAAD;MAAA;;MAAA,mCAAUxD,IAAV;QAAUA,IAAV;;;MAAA,OACb,iBAAKoE,iBAAL,gBACE,MAAKF,qBAAL,CAA2BV,IAA3B,EAAiCnB,GAAjC,CAAqC;QAAA,IAAGtG,EAAH,SAAGA,EAAH;QAAA,OAAYA,EAAZ;OAArC,CADF,SAEKiE,IAFL,EADa;;;kEAMD,UAACqE,OAAD;MAAA,IAAU9J,IAAV,uEAAiBkI,gBAAjB;;MAAA,oCAAsCzC,IAAtC;QAAsCA,IAAtC;;;MAAA,OACZ,IAAI3G,OAAJ,CAAY,UAACC,OAAD,EAAa;QACvB,IAAMgL,aAAa,GAAG,EAAtB;QAEAD,OAAO,CAAC3J,OAAR,CAAgB,UAACqB,EAAD,EAAQ;UACtB,IAAMwE,KAAK,GAAG,MAAKD,KAAL,CAAWtE,GAAX,CAAeD,EAAf,CAAd;;UAEA,IAAI,CAACwE,KAAL,EAAY;YACV;;;UAGF,IAAMyC,MAAM,GAAG,MAAKlB,OAAL,CAAa9F,GAAb,CAAiBD,EAAjB,CAAf;;UACAuI,aAAa,CAACrK,IAAd,CAAmB+I,MAAnB;SARF;;QAWA,IAAIsB,aAAa,CAAC9I,MAAd,KAAyB,CAA7B,EAAgC;UAC9BlC,OAAO,CAAC,KAAD,CAAP;UACA;;;QAGFD,OAAO,CAACkL,GAAR,CACED,aAAa,CAACjC,GAAd,CAAkB,UAACW,MAAD;UAAA,OAAY,oBAAIA,MAAJ,EAAYzI,IAAZ,SAAqByF,IAArB,EAAZ;SAAlB,CADF,EAEEuD,IAFF,CAEO,UAACiB,SAAD;UAAA,OAAelL,OAAO,CAACkL,SAAS,CAAC3F,KAAV,CAAgB4F,OAAhB,CAAD,CAAtB;SAFP;OAnBF,CADY;;;4DAyBN;MAAA;;MAAA,oCAAIzE,IAAJ;QAAIA,IAAJ;;;MAAA,OACN,kBAAKgE,WAAL,iBACE,MAAKP,eAAL,GAAuBpB,GAAvB,CAA2B;QAAA,IAAGtG,EAAH,SAAGA,EAAH;QAAA,OAAYA,EAAZ;OAA3B,CADF,EAEE0G,gBAFF,SAGKzC,IAHL,EADM;;;+DAOG,UAACjE,EAAD;MAAA,OAAQ,MAAKuE,KAAL,CAAWtE,GAAX,CAAeD,EAAf,CAAR;;;8DACD,UAACA,EAAD;MAAA,OAAQ,MAAKgF,KAAL,CAAW/E,GAAX,CAAeD,EAAf,CAAR;;;sEACQ;MAAA,0BAAU,MAAKgF,KAAL,CAAW2D,MAAX,EAAV;;;8DAGR;MACRC,IAAI,EAAE,MAAKA,IADH;MAERrB,MAAM,EAAE,MAAKA,MAFL;MAGR7E,IAAI,EAAE,MAAKA,IAHH;MAIRmG,SAAS,EAAE,MAAKA,SAJR;MAKRC,QAAQ,EAAE,MAAKA,QALP;MAMRV,cAAc,EAAE,MAAKA,cANb;MAORW,OAAO,EAAE,MAAKA,OAPN;MAQRC,YAAY,EAAE,MAAKA,YARX;MASRC,WAAW,EAAE,MAAKA,WATV;MAURZ,iBAAiB,EAAE,MAAKA,iBAVhB;MAWRH,WAAW,EAAE,MAAKA,WAXV;MAYRgB,KAAK,EAAE,MAAKA,KAZJ;MAaRnB,QAAQ,EAAE,MAAKA,QAbP;MAcRoB,OAAO,EAAE,MAAKA,OAdN;MAeRzB,eAAe,EAAE,MAAKA;;;;;;;;WAGxB,kBAAS;MAAA;;MACP,2BAA4B,KAAKpM,KAAjC,CAAQK,QAAR;UAAQA,QAAR,qCAAmB,IAAnB;MAEA,oBACEmB,6BAACjC,oBAAD;QAAoB,KAAK,EAAE,KAAKoK,OAAhC;QAAA;SACGtJ,QADH,eAEEmB;QAAK,KAAK,EAAE;UAAEsM,OAAO,EAAE;SAAvB;QAAA;SACG,mBAAI,KAAKpE,KAAL,CAAW2D,MAAX,EAAJ,EAAyBrC,GAAzB,CAA6B;QAAA,IAAG3K,QAAH,SAAGA,QAAH;YAAgBL,KAAhB;;QAAA,oBAC5BwB,6BAAC,MAAD;UACE,GAAG,EAAExB,KAAK,CAAC0E;WACP1E,KAFN;UAGE,KAAK,EAAE,OAHT;UAIE,KAAK,EAAE,OAAI,CAACiJ,KAJd;UAKE,OAAO,EAAE,OAAI,CAACwB,OALhB;UAME,GAAG,EAAE,aAACkB,MAAD,EAAY;YACf,OAAI,CAAClB,OAAL,CAAa1F,GAAb,CAAiB/E,KAAK,CAAC0E,EAAvB,EAA2BiH,MAA3B;WAPJ;UAAA;YAUGtL,QAVH,CAD4B;OAA7B,CADH,CAFF,CADF;;;;;EAjKoCC;;;;;;;;ACDxC,SAASyN,oBAAT,CAA8BC,UAA9B,EAA0C;EACxC,IACE5G,IADF,GAOI4G,UAPJ,CACE5G,IADF;MAEEmG,SAFF,GAOIS,UAPJ,CAEET,SAFF;MAGEE,OAHF,GAOIO,UAPJ,CAGEP,OAHF;MAIEC,YAJF,GAOIM,UAPJ,CAIEN,YAJF;MAKEE,KALF,GAOII,UAPJ,CAKEJ,KALF;MAMExB,eANF,GAOI4B,UAPJ,CAME5B,eANF;EAQA,OAAO;IAAEhF,IAAI,EAAJA,IAAF;IAAQmG,SAAS,EAATA,SAAR;IAAmBE,OAAO,EAAPA,OAAnB;IAA4BC,YAAY,EAAZA,YAA5B;IAA0CE,KAAK,EAALA,KAA1C;IAAiDxB,eAAe,EAAfA;GAAxD;AACD;;AAED,AAAO,IAAM6B,eAAe,GAAG,SAAlBA,eAAkB,CAACC,SAAD,EAAe;EAC5C,IAAM/I,aAAa,GAAG,SAAhBA,aAAgB,OAAkC;IAAA,IAA/BgJ,QAA+B,QAA/BA,QAA+B;QAArBxE,OAAqB,QAArBA,OAAqB;QAAZ3J,KAAY,QAAZA,KAAY;;IACtD,IAAMoO,mBAAmB,GAAG,aAAYzE,OAAZ,CAA5B;;IAEA,IAAIyE,mBAAJ,EAAyB;MACvBrK,OAAO,CAACuC,KAAR,CAAc,yDAAd;;;IAGF,OAAO8H,mBAAmB,GACxB,KAAIpO,KAAJ,EAAW,UAAX,EAAuB,IAAvB,CADwB,gBAGxBwB,6BAAC,OAAD;MAAS,MAAM,EAAE2M,QAAjB;MAA2B,GAAG,EAAEnO,KAAK,CAACqO,GAAtC;MAA2C,SAAS,EAAErO,KAAK,CAACsO,QAA5D;MAAA;OACG,UAACC,IAAD,EAAU;MACT,IAAM7J,EAAE,GAAG1E,KAAK,CAACsO,QAAN,IAAkBC,IAA7B;MAEA,oBACE/M,6BAAC,QAAD;QAAU,GAAG,EAAEkD,EAAf;QAAmB,EAAE,EAAEA,EAAvB;QAAA;SACG,UAACkC,WAAD;QAAA,oBACCpF,6BAAC,SAAD;UACE,GAAG,EAAEkD;WACD1E,KAFN,EAGM4G,WAHN;UAIE,EAAE,EAAElC,EAJN;UAKE,QAAQ,EAAEiF,OALZ;UAAA;WADD;OADH,CADF;KAJJ,CAHF;GAPF;;EA+BA,IAAM6E,UAAU,GAAG,SAAbA,UAAa;IAAA,IAAOL,QAAP,SAAGzJ,EAAH;QAAoB1E,KAApB;;IAAA,OACjBmF,aAAa,CAAC;MAAEgJ,QAAQ,EAARA,QAAF;MAAYxE,OAAO,EAAE1I,eAAe,EAApC;MAAwCjB,KAAK,EAALA;KAAzC,CADI;GAAnB;;EAGA,IAAMyO,UAAU,GAAG,SAAbA,UAAa;IAAA,IAAON,QAAP,SAAGzJ,EAAH;QAAoB1E,KAApB;;IAAA,oBACjBwB,6BAAC/B,oBAAD;MAAA;OACG,UAACkK,OAAD;MAAA,OAAaxE,aAAa,CAAC;QAAEgJ,QAAQ,EAARA,QAAF;QAAYxE,OAAO,EAAPA,OAAZ;QAAqB3J,KAAK,EAALA;OAAtB,CAA1B;KADH,CADiB;GAAnB;;EAMA,OAAO,YAAWkB,gBAAX,IAAyBsN,UAAzB,GAAsCC,UAA7C;AACD,CA1CM;;AA4CP,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAACxH,gBAAD,EAAsB;EAC3C,IAAM/B,aAAa,GAAG,SAAhBA,aAAgB;IAAA,IAAGwE,OAAH,SAAGA,OAAH;QAAY3J,KAAZ,SAAYA,KAAZ;QAAmBqH,YAAnB,SAAmBA,YAAnB;IAAA,oBACpB7F,6BAAC,gBAAD,eAAsBxB,KAAtB,EAAiC2J,OAAjC;MAA0C,GAAG,EAAEtC,YAA/C;MAAA;OADoB;GAAtB;;EAIA,IAAMsH,SAAS,GAAG,SAAZA,SAAY;IAAA,IAAGtH,YAAH,SAAGA,YAAH;QAAoBrH,KAApB;;IAAA,OAChBmF,aAAa,CAAC;MACZwE,OAAO,EAAEoE,oBAAoB,CAAC9M,eAAe,MAAM,EAAtB,CADjB;MAEZjB,KAAK,EAALA,KAFY;MAGZqH,YAAY,EAAZA;KAHW,CADG;GAAlB;;EAOA,IAAMuH,SAAS,GAAG,SAAZA,SAAY;IAAA,IAAGvH,YAAH,SAAGA,YAAH;QAAoBrH,KAApB;;IAAA,oBAChBwB,6BAAC/B,oBAAD;MAAA;OACG;MAAA,IAACuO,UAAD,uEAAc,EAAd;MAAA,OACC7I,aAAa,CAAC;QACZwE,OAAO,EAAEoE,oBAAoB,CAACC,UAAD,CADjB;QAEZhO,KAAK,EAALA,KAFY;QAGZqH,YAAY,EAAZA;OAHW,CADd;KADH,CADgB;GAAlB;;EAYA,IAAMwH,iBAAiB,GAAG,YAAW3N,gBAAX,IAAyByN,SAAzB,GAAqCC,SAA/D;;EAEA,IAAI,YAAW7G,gBAAX,CAAJ,EAA4B;IAC1B,IAAMC,eAAe,gBAAGD,gBAAU,CAAC,UAAC/H,KAAD,EAAQuH,GAAR;MAAA,oBACjC/F,6BAAC,iBAAD,eAAuBxB,KAAvB;QAA8B,YAAY,EAAEuH,GAA5C;QAAA;SADiC;KAAD,CAAlC;IAIA,OAAOU,YAAY,CAACD,eAAD,EAAkBd,gBAAlB,CAAnB;GALF,MAMO;IACL,OAAOe,YAAY,CAAC4G,iBAAD,EAAoB3H,gBAApB,CAAnB;;AAEH,CAnCD;;AAqCA,IAAa4H,kBAAkB,GAAG,SAArBA,kBAAqB,GAAM;EACtC,IAAI,CAAC,YAAW5N,gBAAX,CAAL,EAA6B;IAC3B,OAAO,EAAP;;;EAGF,IAAMkD,QAAQ,GAAGnD,eAAe,EAAhC;;EAEA,IAAI,CAACmD,QAAL,EAAe;IACb,OAAO,EAAP;;;EAGF,OAAO2J,oBAAoB,CAAC3J,QAAD,CAA3B;AACD,CAZM;;AC5FP,SAAS2K,gBAAT,GAAqC;EAAA,IAAX5E,IAAW,uEAAJ,EAAI;;EACnC,IAAI,CAAC,SAAQA,IAAR,CAAL,EAAoB;IAClB,OAAO,KAAP;;;EAGF,OACEA,IAAI,CAAC6E,WAAL,GAAmB7E,IAAI,CAAC8E,WAAxB,IAAuC9E,IAAI,CAAC+E,YAAL,GAAoB/E,IAAI,CAACgF,YADlE;AAGD;;AAED,SAASC,kBAAT,CAA4BC,IAA5B,EAAkC;EAChC,IAAI,CAAC,YAAW,kBAAU,2BAAV,CAAX,CAAL,EAAyD;IACvD,OAAO,EAAP;;;EAGF,OAAO,6BAAI,OAAM,KAAIA,IAAJ,EAAU,kBAAV,EAA8B,GAA9B,CAAN,EAA0C,EAA1C,CAAJ,IAAmDA,IAAnD,GAAyDhD,MAAzD,CACL0C,gBADK,CAAP;AAGD;;AAED,AAAe,SAASO,kBAAT,CAA4BD,IAA5B,EAAkC;EAC/C,IAAM3F,KAAK,sBAAO,IAAIN,GAAJ,oBAAY,SAAQiG,IAAI,CAACrE,GAAL,CAASoE,kBAAT,CAAR,CAAZ,EAAP,CAAX;;EAEA,IAAMG,KAAK,GAAG7F,KAAK,CAACsB,GAAN,CAAU,UAACb,IAAD;IAAA,OAAU,CAChCA,IADgC,EAEhC;MACEqF,CAAC,EAAErF,IAAI,CAACsF,UADV;MAEEC,CAAC,EAAEvF,IAAI,CAACwF;KAJsB,CAAV;GAAV,CAAd;EAQA,OAAO,SAASC,MAAT,GAAkB;IACvBL,KAAK,CAAClM,OAAN,CAAc,gBAAsB;MAAA;UAApB8G,IAAoB;;UAAZqF,CAAY,UAAZA,CAAY;UAATE,CAAS,UAATA,CAAS;;MAClCvF,IAAI,CAACsF,UAAL,GAAkBD,CAAlB;MACArF,IAAI,CAACwF,SAAL,GAAiBD,CAAjB;KAFF;GADF;AAMD;;;;AC/CD;AAqBA,IAAMG,IAAI,GAAG,kBAAU,eAAV,CAAb;;AACA,IAAMC,sBAAsB,GAAG,kBAE7B,2BAF6B,EAG7B,kBAAU,0BAAV,EAAsC,EAAtC,CAH6B,CAA/B;;AAMA,IAAMC,YAAY,GAAG,SAAfA,YAAe,CAAC5D,IAAD;EAAA,4BAEjBA,IAAI,oBAAYA,IAAZ,WAAuB,EAFV;AAAA,CAArB;;AAOA,IAAM6D,eAAe,GAAG,SAAlBA,eAAkB,CAACC,GAAD,EAAS;EAC/B,IAAI,SAAQA,GAAR,CAAJ,EAAkB;IAChB,OAAOA,GAAP;;;EAGF,OAAO,CAACA,GAAD,CAAP;AACD,CAND;;IAQM/B;;;;;;;;EA6BJ,mBAAYlO,KAAZ,EAAmB;IAAA;;IAAA;;IACjB,0BAAMA,KAAN;;IADiB,8DAxBL,CAwBK;;IAAA,4DAvBP,UAAS,YAAM;MACzB,IAAQmM,IAAR,GAAiB,MAAKnM,KAAtB,CAAQmM,IAAR;MACApI,OAAO,CAACuC,KAAR,CAAcyJ,YAAY,CAAC5D,IAAD,CAA1B;KAFU,EAGT,GAHS,CAuBO;;IAAA,qEAnBE,UAAS,YAAM;MAClC,MAAK+D,WAAL,GAAmB,CAAnB;KADmB,EAElB,EAFkB,CAmBF;;IAAA,sEAhBG,YAAM;MAC1B,IAAMC,mBAAmB,GAAG,MAAKD,WAAL,GAAmB,EAA/C;;MAEA,IAAIC,mBAAJ,EAAyB;QACvB,MAAKC,SAAL;;;MAGF,MAAKF,WAAL;;MACA,MAAKG,kBAAL;;MAEA,OAAOF,mBAAP;KAMiB;;IAAA,qDAHd,IAGc;;IAAA,8DAFL,IAEK;;IAAA,yDADV,KACU;;IAAA,yDAkCV,YAAwB;MAAA,IAAvBG,WAAuB,uEAAT,IAAS;MAC/B,kBAA6C,MAAKtQ,KAAlD;UAAQ0E,EAAR,eAAQA,EAAR;UAAY4K,kBAAZ,eAAYA,kBAAZ;UAAgCiB,QAAhC,eAAgCA,QAAhC;;MACA,IAAMrH,KAAK,GAAGqH,QAAQ,CAAC9D,QAAT,CAAkB/H,EAAlB,CAAd,CAF+B;;;MAI/B,IAAI;;;;;;;;;;;QAWFwE,KAAK,CAACQ,KAAN,CAAYrG,OAAZ,CAAoB,UAAC8G,IAAD,EAAU;UAC5B,MAAK/H,WAAL,CAAiBsI,WAAjB,CAA6BP,IAA7B;SADF;;QAIA,IAAImG,WAAW,IAAIhB,kBAAnB,EAAuC;;UAErC,KAAIpG,KAAK,CAACsH,eAAV;;OAjBJ,CAmBE,OAAOlK,KAAP,EAAc;;KAzDC;;IAAA,wDA+DX,YAA2B;MAAA,IAA1BmK,cAA0B,uEAAT,IAAS;MACjC,mBAAyB,MAAKzQ,KAA9B;UAAQ0E,EAAR,gBAAQA,EAAR;UAAY6L,QAAZ,gBAAYA,QAAZ;;MACA,IAAMrH,KAAK,GAAGqH,QAAQ,CAAC9D,QAAT,CAAkB/H,EAAlB,CAAd;;MACA,IAAMgM,6BAA6B,GAAG,SACpC,SAAQ,CAAC,MAAK1Q,KAAL,CAAWsP,kBAAZ,CAAR,EAAyCtE,GAAzC,CAA6C,UAAC2F,IAAD,EAAU;QACrD,IAAIA,IAAI,KAAK,IAAb,EAAmB;UACjB,OAAOzH,KAAK,CAACQ,KAAb;;;QAGF,IAAIiH,IAAI,KAAK,QAAb,EAAuB;UACrB,OAAO,CAACb,sBAAD,EAAyBD,IAAzB,CAAP;;;QAGF,0BAAW,OAAM,kBAAU,2BAAV,EAAuCc,IAAvC,CAAN,EAAoD,EAApD,CAAX;OATF,CADoC,EAYpCtE,MAZoC,CAY7Be,OAZ6B,CAAtC,CAHiC;;;MAkBjC,IAAI;QACF,IAAIqD,cAAc,IAAIC,6BAA6B,CAACvM,MAA9B,GAAuC,CAA7D,EAAgE;;UAE9D+E,KAAK,CAACsH,eAAN,GAAwBlB,kBAAkB,CACxCoB,6BADwC,CAA1C;SAHA;;;;;;;;;;;;;;;;QAsBFxH,KAAK,CAACQ,KAAN,CAAYrG,OAAZ,CAAoB,UAAC8G,IAAD,EAAU;UAC5B,IAAIsG,cAAJ,EAAoB;YAClB,MAAKrO,WAAL,CAAiBwO,WAAjB,CAA6BzG,IAA7B;WADF,MAEO;YACLjB,KAAK,CAACkB,OAAN,CAAcM,WAAd,CAA0BP,IAA1B;;SAJJ;OAtBF,CA6BE,OAAO7D,KAAP,EAAc;;KA9GC;;IAAA,uDAmHZ,YAAM;MACX,mBAA4C,MAAKtG,KAAjD;UAAQuQ,QAAR,gBAAQA,QAAR;UAAkB7L,EAAlB,gBAAkBA,EAAlB;UAAsBrE,QAAtB,gBAAsBA,QAAtB;UAAmCsI,IAAnC,uDADW;;;MAIX4H,QAAQ,CACLjD,IADH,CACQ5I,EADR;QAEIrE,QAAQ,EAARA,QAFJ;QAGIwQ,WAAW,EAAE;UAAA;;SACVlI,IAJP,GAMGuD,IANH,CAMQ,UAAChD,KAAD,EAAW;;QAEf,IAAI,CAACA,KAAL,EAAY;UACV;;;QAGF,MAAK4H,MAAL,GANe;;;QASf,IAAI5H,KAAK,CAACqB,MAAV,EAAkB;UAChB,oCAAUxD,kBAAV;SADF,MAEO;UACLmC,KAAK,CAACqB,MAAN,GAAe,IAAf;;;QAEF,MAAKC,MAAL,GAAc,KAAd;OApBJ;KAvHiB;;IAAA,yDA+IV,YAA0C;MAAA,+EAAP,EAAO;UAAvC+F,QAAuC,QAAvCA,QAAuC;UAA7B7L,EAA6B,QAA7BA,EAA6B;UAAzByH,IAAyB,QAAzBA,IAAyB;UAAhBxD,IAAgB;;MACjD,IAAI,CAAC4H,QAAD,IAAa,MAAK/F,MAAlB,IAA4B,MAAK2F,mBAAL,CAAyBhE,IAAzB,CAAhC,EAAgE;QAC9D;OAF+C;;;;;;MASjDoE,QAAQ,CAACtE,MAAT,CAAgBvH,EAAhB;QACEyH,IAAI,EAAJA,IADF;QAEE0E,WAAW,EAAE;UAAA;;SACVlI,IAHL,GATiD;;KA/IhC;;IAEjB,MAAKjE,EAAL,GAAU1E,KAAK,CAAC0E,EAAhB;;IACA,MAAKqM,IAAL;;;IAGC,CAAChK,kBAAD,EAAqBC,oBAArB,EAA2C3D,OAA3C,CAAmD,UAACoE,aAAD,EAAmB;MACrE,MAAKA,aAAL,IAAsB,YAAM;QAC1B,mBAAyB,MAAKzH,KAA9B;YAAQ0E,EAAR,gBAAQA,EAAR;YAAY6L,QAAZ,gBAAYA,QAAZ;;QACA,IAAMrH,KAAK,GAAGqH,QAAQ,CAAC9D,QAAT,CAAkB/H,EAAlB,CAAd;;QACA,IAAMyF,IAAI,GAAGoG,QAAQ,CAAC1C,OAAT,CAAiBnJ,EAAjB,CAAb;;QACA,IAAIyF,IAAI,IAAI1C,aAAa,KAAKV,kBAA9B,EAAkD;UAChDoD,IAAI,CAAC6B,UAAL,GAAkBF,IAAI,CAACD,GAAL,EAAlB;;;QAGF,IAAMrB,MAAM,GAAG/C,aAAa,KAAKT,oBAAjC,CAR0B;;QAW1B,IAAI,CAACkC,KAAD,IAAUA,KAAK,CAACO,QAApB,EAA8B;;UAE5B,IAAI,MAAKe,MAAL,IAAe,CAACA,MAApB,EAA4B;YAC1B,MAAKuG,IAAL;;;UAEF;;;QAGF,KAAI7H,KAAJ,EAAWzB,aAAX;;QACAyB,KAAK,CAACsB,MAAN,GAAeA,MAAf;QACA,MAAKA,MAAL,GAAcA,MAAd;OArBF;KADD;IANgB;;;;;;;IAiKnB,+BAAsBrK,SAAtB,EAAiC;MAC/B,KAAK8L,MAAL,CAAY9L,SAAZ;MAEA,OAAO,KAAP;;;;;WAIF,gCAAuB;MACrB,mBAAgD,KAAKH,KAArD;UAAQ0E,EAAR,gBAAQA,EAAR;UAAY6L,QAAZ,gBAAYA,QAAZ;2CAAsBS,IAAtB;UAA4BC,QAA5B,kCAAuC,IAAvC;;MACA,IAAM/H,KAAK,GAAGqH,QAAQ,CAAC9D,QAAT,CAAkB/H,EAAlB,CAAd;;MACA,uBAAwBsL,eAAe,CAAC,KAAIiB,QAAJ,CAAD,CAAvC;;UAAOD,IAAP;UAAaE,OAAb;;MAEA,IAAI,CAAChI,KAAL,EAAY;QACV;;;MAGF,KAAKiI,KAAL;MACA,OAAOjI,KAAK,CAAC2H,WAAb;;MAEA,IAAI,CAACG,IAAL,EAAW;QACT,IAAIE,OAAJ,EAAa;UACX,IAAME,UAAU,GAAG,CACjBlI,KADiB,4BAEdqH,QAAQ,CAAC3D,WAAT,CAAqB,CAAClI,EAAD,CAArB,EAA2BsG,GAA3B,CAA+B,UAACtG,EAAD;YAAA,OAAQ6L,QAAQ,CAAC9D,QAAT,CAAkB/H,EAAlB,CAAR;WAA/B,CAFc,GAGjB2H,MAHiB,CAGVe,OAHU,CAAnB;UAKAgE,UAAU,CAAC/N,OAAX,CAAmB,UAAC6F,KAAD,EAAW;YAC5BA,KAAK,CAACO,QAAN,GAAiB,IAAjB;WADF;;UAGA,UAAS;YAAA,OAAM8G,QAAQ,CAACzD,cAAT,CAAwB,CAACpI,EAAD,CAAxB,CAAN;WAAT;SATF,MAUO;UACLwE,KAAK,CAACO,QAAN,GAAiB,IAAjB;;UACA,UAAS;YAAA,OAAM8G,QAAQ,CAAC/C,QAAT,CAAkB9I,EAAlB,CAAN;WAAT;;OAzBiB;;;MA8BrB,KAAI,IAAJ,EAAUsC,oBAAV;;;;WAGF,kBAAS;MAAA;;MACP,oBACExF;QACE,GAAG,EAAC,wBADN;QAGE,SAAS,EAAC,YAHZ;QAIE,GAAG,EAAE,aAAC2I,IAAD,EAAU;UACb,MAAI,CAAC/H,WAAL,GAAmB+H,IAAnB;;QANN;;;;;EAvOoB7J;;;gBAAlB4N,2BACkB;EACpBoB,kBAAkB,EAAE;AADA;;AAoPxB,SAAS+B,YAAT,QAAoC;EAAA,IAAZhR,QAAY,SAAZA,QAAY;EAClC,oBACEmB;IAAK,GAAG,EAAC,wBAAT;IAAgD,SAAS,EAAC;kBACxDA;IAAK,GAAG,EAAC,kBAAT;IAA0C,SAAS,EAAC;KACjDnB,QADH,CADF,CADF;AAOD;;AAED,kBAAe,YAAW,kBAAU,yBAAV,CAAX,IACX4N,eAAe,CAAChH,cAAc,CAACiH,SAAD,CAAf,CADJ,GAEXmD,YAFJ;;;;;;;;;;;;;;;"}